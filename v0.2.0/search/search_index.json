{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"django-slack-tools","text":"<p>Little helpers working with Slack bot \ud83e\udd16 in Django.</p> <p>This project aims to implementing helpful features making Slack bot and providing reusable Django apps integrated with database.</p>"},{"location":"#features","title":"Features","text":"<p>Key features are:</p> <ul> <li> <p> Reusable Django app for Slack messaging with various messaging backends for different environments</p> </li> <li> <p> Database-backed Slack messaging policies with simple dictionary-based template</p> </li> <li> <p> Message histories</p> </li> <li> <p> Built-in admin for management working with Slack workspace</p> </li> <li> <p> Django template support</p> </li> <li> <p> Celery support for messaging backends, management and shortcut tasks, etc.</p> </li> </ul> <p>And more in future roadmap...</p> <ul> <li> <p> New Django apps and helpers for Slack features such as modals, event subscription, etc.</p> </li> <li> <p> More fine working example with rich documentation</p> </li> </ul> <p>Currently it is focused on messaging features. In future, hoping to bring more helpful features across Slack Bot ecosystem, such as event subscriptions, modals, bot interactions, etc.</p>"},{"location":"api-references/slack-messages/celery/","title":"Celery Support","text":""},{"location":"api-references/slack-messages/celery/#django_slack_tools.slack_messages.tasks","title":"<code>django_slack_tools.slack_messages.tasks</code>","text":"<p>Celery utils.</p>"},{"location":"api-references/slack-messages/celery/#django_slack_tools.slack_messages.tasks.cleanup_old_messages","title":"<code>cleanup_old_messages(*, base_ts=None, threshold_seconds=7 * 24 * 60 * 60)</code>","text":"<p>Delete old messages created before given threshold.</p> <p>Parameters:</p> Name Type Description Default <code>threshold_seconds</code> <code>int | None</code> <p>Threshold seconds. Defaults to 7 days.</p> <code>7 * 24 * 60 * 60</code> <code>base_ts</code> <code>str | None</code> <p>Base timestamp to calculate the threshold, in ISO format. If falsy, current timestamp will be used.</p> <code>None</code> <p>Returns:</p> Type Description <code>int</code> <p>Number of deleted messages.</p> Source code in <code>django_slack_tools/slack_messages/tasks.py</code> <pre><code>@shared_task\ndef cleanup_old_messages(\n    *,\n    base_ts: str | None = None,\n    threshold_seconds: int | None = 7 * 24 * 60 * 60,  # 7 days\n) -&gt; int:\n    \"\"\"Delete old messages created before given threshold.\n\n    Args:\n        threshold_seconds: Threshold seconds. Defaults to 7 days.\n        base_ts: Base timestamp to calculate the threshold, in ISO format. If falsy, current timestamp will be used.\n\n    Returns:\n        Number of deleted messages.\n    \"\"\"\n    dt = datetime.fromisoformat(base_ts) if base_ts else timezone.localtime()\n\n    if threshold_seconds is None:\n        logger.warning(\"Threshold seconds not provided, skipping cleanup.\")\n        return 0\n\n    cleanup_threshold = dt - timedelta(seconds=threshold_seconds)\n    logger.debug(\"Cleaning up messages older than %s.\", cleanup_threshold)\n\n    num_deleted, _ = SlackMessage.objects.filter(created__lt=cleanup_threshold).delete()\n    logger.info(\"Deleted %d old messages.\", num_deleted)\n\n    return num_deleted\n</code></pre>"},{"location":"api-references/slack-messages/celery/#django_slack_tools.slack_messages.tasks.slack_message","title":"<code>slack_message(body, *, channel, header=None, raise_exception=False, get_permalink=False)</code>","text":"<p>Celery task wrapper for <code>message.slack_message</code>.</p> <p>Parameters:</p> Name Type Description Default <code>body</code> <code>str | dict[str, Any]</code> <p>Message content, simple message or full request body.</p> required <code>channel</code> <code>str</code> <p>Channel to send message.</p> required <code>header</code> <code>dict[str, Any] | None</code> <p>Slack message control header.</p> <code>None</code> <code>raise_exception</code> <code>bool</code> <p>Whether to re-raise caught exception while sending messages.</p> <code>False</code> <code>get_permalink</code> <code>bool</code> <p>Try to get the message permalink via extraneous Slack API calls.</p> <code>False</code> <p>Returns:</p> Type Description <code>int | None</code> <p>ID of sent message.</p> Source code in <code>django_slack_tools/slack_messages/tasks.py</code> <pre><code>@shared_task\ndef slack_message(\n    body: str | dict[str, Any],\n    *,\n    channel: str,\n    header: dict[str, Any] | None = None,\n    raise_exception: bool = False,\n    get_permalink: bool = False,\n) -&gt; int | None:\n    \"\"\"Celery task wrapper for `message.slack_message`.\n\n    Args:\n        body: Message content, simple message or full request body.\n        channel: Channel to send message.\n        header: Slack message control header.\n        raise_exception: Whether to re-raise caught exception while sending messages.\n        get_permalink: Try to get the message permalink via extraneous Slack API calls.\n\n    Returns:\n        ID of sent message.\n    \"\"\"\n    sent_msg = message.slack_message(\n        body,\n        channel=channel,\n        header=header,\n        raise_exception=raise_exception,\n        get_permalink=get_permalink,\n    )\n    return sent_msg.id\n</code></pre>"},{"location":"api-references/slack-messages/celery/#django_slack_tools.slack_messages.tasks.slack_message_via_policy","title":"<code>slack_message_via_policy(policy, *, header=None, raise_exception=False, lazy=False, get_permalink=False, context=None)</code>","text":"<p>Celery task wrapper for <code>message.slack_message_via_policy</code>.</p> <p>Parameters:</p> Name Type Description Default <code>policy</code> <code>str</code> <p>Messaging policy code.</p> required <code>header</code> <code>dict[str, Any] | None</code> <p>Slack message control header.</p> <code>None</code> <code>raise_exception</code> <code>bool</code> <p>Whether to re-raise caught exception while sending messages.</p> <code>False</code> <code>lazy</code> <code>bool</code> <p>Decide whether try to create policy with disabled, if not exists.</p> <code>False</code> <code>get_permalink</code> <code>bool</code> <p>Try to get the message permalink via extraneous Slack API calls.</p> <code>False</code> <code>context</code> <code>dict[str, Any] | None</code> <p>Context variables for message rendering.</p> <code>None</code> <p>Returns:</p> Type Description <code>int</code> <p>Number of sent messages.</p> Source code in <code>django_slack_tools/slack_messages/tasks.py</code> <pre><code>@shared_task\ndef slack_message_via_policy(  # noqa: PLR0913\n    policy: str,\n    *,\n    header: dict[str, Any] | None = None,\n    raise_exception: bool = False,\n    lazy: bool = False,\n    get_permalink: bool = False,\n    context: dict[str, Any] | None = None,\n) -&gt; int:\n    \"\"\"Celery task wrapper for `message.slack_message_via_policy`.\n\n    Args:\n        policy: Messaging policy code.\n        header: Slack message control header.\n        raise_exception: Whether to re-raise caught exception while sending messages.\n        lazy: Decide whether try to create policy with disabled, if not exists.\n        get_permalink: Try to get the message permalink via extraneous Slack API calls.\n        context: Context variables for message rendering.\n\n    Returns:\n        Number of sent messages.\n    \"\"\"\n    return message.slack_message_via_policy(\n        policy,\n        header=header,\n        raise_exception=raise_exception,\n        lazy=lazy,\n        get_permalink=get_permalink,\n        context=context,\n    )\n</code></pre>"},{"location":"api-references/slack-messages/messaging-backends/","title":"Messaging Backends","text":""},{"location":"api-references/slack-messages/messaging-backends/#django_slack_tools.slack_messages.backends","title":"<code>django_slack_tools.slack_messages.backends</code>","text":""},{"location":"api-references/slack-messages/messaging-backends/#django_slack_tools.slack_messages.backends.BaseBackend","title":"<code>BaseBackend</code>","text":"<p>               Bases: <code>ABC</code></p> <p>Abstract base class for messaging backends.</p> Source code in <code>django_slack_tools/slack_messages/backends/base.py</code> <pre><code>class BaseBackend(ABC):\n    \"\"\"Abstract base class for messaging backends.\"\"\"\n\n    def prepare_message(\n        self,\n        *,\n        policy: SlackMessagingPolicy | None = None,\n        channel: str,\n        header: MessageHeader,\n        body: MessageBody,\n    ) -&gt; SlackMessage:\n        \"\"\"Prepare message.\n\n        Args:\n            policy: Related policy instance.\n            channel: Channel to send message.\n            header: Slack message control header.\n            body: Slack message body.\n\n        Returns:\n            Prepared message.\n        \"\"\"\n        _header: dict = policy.header_defaults if policy else {}\n        _header.update(dataclasses.asdict(header))\n\n        _body = dataclasses.asdict(body)\n\n        return SlackMessage(policy=policy, channel=channel, header=_header, body=_body)\n\n    def prepare_messages_from_policy(\n        self,\n        policy: SlackMessagingPolicy,\n        *,\n        header: MessageHeader,\n        context: dict[str, Any],\n    ) -&gt; list[SlackMessage]:\n        \"\"\"Prepare messages from policy.\n\n        Args:\n            policy: Policy to create messages from.\n            header: Common message header.\n            context: Message context.\n\n        Returns:\n            Prepared messages.\n        \"\"\"\n        overridden_reserved = RESERVED_CONTEXT_KWARGS &amp; set(context.keys())\n        if overridden_reserved:\n            logger.warning(\n                \"Template keyword argument(s) %s reserved for passing mentions, but already exists.\"\n                \" User provided value will override it.\",\n                \", \".join(f\"`{s}`\" for s in overridden_reserved),\n            )\n\n        messages: list[SlackMessage] = []\n        for recipient in policy.recipients.all():\n            logger.debug(\"Sending message to recipient %s\", recipient)\n\n            # Initialize template instance\n            template = self._get_template_instance_from_policy(policy)\n\n            # Prepare rendering arguments\n            render_context = self._get_default_context(policy=policy, recipient=recipient)\n            render_context.update(context)\n            logger.debug(\"Context prepared as: %r\", render_context)\n\n            # Render template and parse as body\n            rendered = template.render(context=render_context)\n            body = MessageBody.from_any(rendered)\n\n            # Create message instance\n            message = self.prepare_message(policy=policy, channel=recipient.channel, header=header, body=body)\n            messages.append(message)\n\n        return SlackMessage.objects.bulk_create(messages)\n\n    def _get_template_instance_from_policy(self, policy: SlackMessagingPolicy) -&gt; BaseTemplate:\n        \"\"\"Get template instance.\"\"\"\n        if policy.template_type == SlackMessagingPolicy.TemplateType.DICT:\n            return DictTemplate(policy.template)\n\n        if policy.template_type == SlackMessagingPolicy.TemplateType.DJANGO:\n            return DjangoTemplate(file=policy.template)\n\n        if policy.template_type == SlackMessagingPolicy.TemplateType.DJANGO_INLINE:\n            return DjangoTemplate(inline=policy.template)\n\n        msg = f\"Unsupported template type: {policy.template_type!r}\"\n        raise ValueError(msg)\n\n    def _get_default_context(self, *, policy: SlackMessagingPolicy, recipient: SlackMessageRecipient) -&gt; dict[str, Any]:\n        \"\"\"Get default context for rendering.\n\n        Following default context keys are created:\n\n        - `policy`: Policy code.\n        - `mentions`: List of mentions.\n        - `mentions_as_str`: Comma-separated joined string of mentions.\n        \"\"\"\n        mentions: list[SlackMention] = list(recipient.mentions.all())\n        mentions_as_str = \", \".join(mention.mention for mention in mentions)\n\n        return {\n            \"policy\": policy.code,\n            \"mentions\": mentions,\n            \"mentions_as_str\": mentions_as_str,\n        }\n\n    def send_messages(self, *messages: SlackMessage, raise_exception: bool, get_permalink: bool) -&gt; int:\n        \"\"\"Shortcut to send multiple messages.\n\n        Args:\n            messages: Messages to send.\n            raise_exception: Whether to propagate exceptions.\n            get_permalink: Try to get the message permalink via additional Slack API call.\n\n        Returns:\n            Count of messages sent successfully.\n        \"\"\"\n        num_sent = 0\n        for message in messages:\n            sent = self.send_message(message=message, raise_exception=raise_exception, get_permalink=get_permalink)\n            num_sent += 1 if sent.ok else 0\n\n        return num_sent\n\n    def send_message(\n        self,\n        message: SlackMessage,\n        *,\n        raise_exception: bool,\n        get_permalink: bool,\n    ) -&gt; SlackMessage:\n        \"\"\"Send message.\n\n        Args:\n            message: Prepared message.\n            raise_exception: Whether to propagate exceptions.\n            get_permalink: Try to get the message permalink via additional Slack API call.\n\n        Returns:\n            Message sent to Slack.\n        \"\"\"\n        try:\n            response: SlackResponse\n            try:\n                response = self._send_message(message)\n            except SlackApiError as err:\n                if raise_exception:\n                    raise\n\n                logger.warning(\n                    \"Error occurred while sending message but suppressed because `raise_exception` set.\",\n                    exc_info=err,\n                )\n                response = err.response\n\n            message.ok = ok = cast(bool, response.get(\"ok\"))\n            if ok:\n                # Get message TS if OK\n                message.ts = cast(str, response.get(\"ts\"))\n\n                # Store thread TS if possible\n                data: dict[str, Any] = response.get(\"message\", {})\n                message.parent_ts = data.get(\"thread_ts\", \"\")\n\n                # Get message permalink\n                if get_permalink:\n                    message.permalink = self._get_permalink(message=message, raise_exception=raise_exception)\n\n            message.request = self._record_request(response)\n            message.response = self._record_response(response)\n        except:  # noqa: E722\n            if raise_exception:\n                raise\n\n            logger.exception(\"Error occurred while sending message but suppressed because `raise_exception` set.\")\n            message.exception = traceback.format_exc()\n        finally:\n            message.save()\n\n        message.refresh_from_db()\n        return message\n\n    @abstractmethod\n    def _send_message(self, message: SlackMessage) -&gt; SlackResponse:\n        \"\"\"Internal implementation of actual 'send message' behavior.\"\"\"\n\n    @abstractmethod\n    def _get_permalink(self, *, message: SlackMessage, raise_exception: bool) -&gt; str:\n        \"\"\"Get a permalink for given message identifier.\"\"\"\n\n    @abstractmethod\n    def _record_request(self, response: SlackResponse) -&gt; Any:\n        \"\"\"Extract request data to be recorded. Should return JSON-serializable object.\"\"\"\n\n    @abstractmethod\n    def _record_response(self, response: SlackResponse) -&gt; Any:\n        \"\"\"Extract response data to be recorded. Should return JSON-serializable object.\"\"\"\n</code></pre>"},{"location":"api-references/slack-messages/messaging-backends/#django_slack_tools.slack_messages.backends.BaseBackend._get_default_context","title":"<code>_get_default_context(*, policy, recipient)</code>","text":"<p>Get default context for rendering.</p> <p>Following default context keys are created:</p> <ul> <li><code>policy</code>: Policy code.</li> <li><code>mentions</code>: List of mentions.</li> <li><code>mentions_as_str</code>: Comma-separated joined string of mentions.</li> </ul> Source code in <code>django_slack_tools/slack_messages/backends/base.py</code> <pre><code>def _get_default_context(self, *, policy: SlackMessagingPolicy, recipient: SlackMessageRecipient) -&gt; dict[str, Any]:\n    \"\"\"Get default context for rendering.\n\n    Following default context keys are created:\n\n    - `policy`: Policy code.\n    - `mentions`: List of mentions.\n    - `mentions_as_str`: Comma-separated joined string of mentions.\n    \"\"\"\n    mentions: list[SlackMention] = list(recipient.mentions.all())\n    mentions_as_str = \", \".join(mention.mention for mention in mentions)\n\n    return {\n        \"policy\": policy.code,\n        \"mentions\": mentions,\n        \"mentions_as_str\": mentions_as_str,\n    }\n</code></pre>"},{"location":"api-references/slack-messages/messaging-backends/#django_slack_tools.slack_messages.backends.BaseBackend._get_permalink","title":"<code>_get_permalink(*, message, raise_exception)</code>  <code>abstractmethod</code>","text":"<p>Get a permalink for given message identifier.</p> Source code in <code>django_slack_tools/slack_messages/backends/base.py</code> <pre><code>@abstractmethod\ndef _get_permalink(self, *, message: SlackMessage, raise_exception: bool) -&gt; str:\n    \"\"\"Get a permalink for given message identifier.\"\"\"\n</code></pre>"},{"location":"api-references/slack-messages/messaging-backends/#django_slack_tools.slack_messages.backends.BaseBackend._get_template_instance_from_policy","title":"<code>_get_template_instance_from_policy(policy)</code>","text":"<p>Get template instance.</p> Source code in <code>django_slack_tools/slack_messages/backends/base.py</code> <pre><code>def _get_template_instance_from_policy(self, policy: SlackMessagingPolicy) -&gt; BaseTemplate:\n    \"\"\"Get template instance.\"\"\"\n    if policy.template_type == SlackMessagingPolicy.TemplateType.DICT:\n        return DictTemplate(policy.template)\n\n    if policy.template_type == SlackMessagingPolicy.TemplateType.DJANGO:\n        return DjangoTemplate(file=policy.template)\n\n    if policy.template_type == SlackMessagingPolicy.TemplateType.DJANGO_INLINE:\n        return DjangoTemplate(inline=policy.template)\n\n    msg = f\"Unsupported template type: {policy.template_type!r}\"\n    raise ValueError(msg)\n</code></pre>"},{"location":"api-references/slack-messages/messaging-backends/#django_slack_tools.slack_messages.backends.BaseBackend._record_request","title":"<code>_record_request(response)</code>  <code>abstractmethod</code>","text":"<p>Extract request data to be recorded. Should return JSON-serializable object.</p> Source code in <code>django_slack_tools/slack_messages/backends/base.py</code> <pre><code>@abstractmethod\ndef _record_request(self, response: SlackResponse) -&gt; Any:\n    \"\"\"Extract request data to be recorded. Should return JSON-serializable object.\"\"\"\n</code></pre>"},{"location":"api-references/slack-messages/messaging-backends/#django_slack_tools.slack_messages.backends.BaseBackend._record_response","title":"<code>_record_response(response)</code>  <code>abstractmethod</code>","text":"<p>Extract response data to be recorded. Should return JSON-serializable object.</p> Source code in <code>django_slack_tools/slack_messages/backends/base.py</code> <pre><code>@abstractmethod\ndef _record_response(self, response: SlackResponse) -&gt; Any:\n    \"\"\"Extract response data to be recorded. Should return JSON-serializable object.\"\"\"\n</code></pre>"},{"location":"api-references/slack-messages/messaging-backends/#django_slack_tools.slack_messages.backends.BaseBackend._send_message","title":"<code>_send_message(message)</code>  <code>abstractmethod</code>","text":"<p>Internal implementation of actual 'send message' behavior.</p> Source code in <code>django_slack_tools/slack_messages/backends/base.py</code> <pre><code>@abstractmethod\ndef _send_message(self, message: SlackMessage) -&gt; SlackResponse:\n    \"\"\"Internal implementation of actual 'send message' behavior.\"\"\"\n</code></pre>"},{"location":"api-references/slack-messages/messaging-backends/#django_slack_tools.slack_messages.backends.BaseBackend.prepare_message","title":"<code>prepare_message(*, policy=None, channel, header, body)</code>","text":"<p>Prepare message.</p> <p>Parameters:</p> Name Type Description Default <code>policy</code> <code>SlackMessagingPolicy | None</code> <p>Related policy instance.</p> <code>None</code> <code>channel</code> <code>str</code> <p>Channel to send message.</p> required <code>header</code> <code>MessageHeader</code> <p>Slack message control header.</p> required <code>body</code> <code>MessageBody</code> <p>Slack message body.</p> required <p>Returns:</p> Type Description <code>SlackMessage</code> <p>Prepared message.</p> Source code in <code>django_slack_tools/slack_messages/backends/base.py</code> <pre><code>def prepare_message(\n    self,\n    *,\n    policy: SlackMessagingPolicy | None = None,\n    channel: str,\n    header: MessageHeader,\n    body: MessageBody,\n) -&gt; SlackMessage:\n    \"\"\"Prepare message.\n\n    Args:\n        policy: Related policy instance.\n        channel: Channel to send message.\n        header: Slack message control header.\n        body: Slack message body.\n\n    Returns:\n        Prepared message.\n    \"\"\"\n    _header: dict = policy.header_defaults if policy else {}\n    _header.update(dataclasses.asdict(header))\n\n    _body = dataclasses.asdict(body)\n\n    return SlackMessage(policy=policy, channel=channel, header=_header, body=_body)\n</code></pre>"},{"location":"api-references/slack-messages/messaging-backends/#django_slack_tools.slack_messages.backends.BaseBackend.prepare_messages_from_policy","title":"<code>prepare_messages_from_policy(policy, *, header, context)</code>","text":"<p>Prepare messages from policy.</p> <p>Parameters:</p> Name Type Description Default <code>policy</code> <code>SlackMessagingPolicy</code> <p>Policy to create messages from.</p> required <code>header</code> <code>MessageHeader</code> <p>Common message header.</p> required <code>context</code> <code>dict[str, Any]</code> <p>Message context.</p> required <p>Returns:</p> Type Description <code>list[SlackMessage]</code> <p>Prepared messages.</p> Source code in <code>django_slack_tools/slack_messages/backends/base.py</code> <pre><code>def prepare_messages_from_policy(\n    self,\n    policy: SlackMessagingPolicy,\n    *,\n    header: MessageHeader,\n    context: dict[str, Any],\n) -&gt; list[SlackMessage]:\n    \"\"\"Prepare messages from policy.\n\n    Args:\n        policy: Policy to create messages from.\n        header: Common message header.\n        context: Message context.\n\n    Returns:\n        Prepared messages.\n    \"\"\"\n    overridden_reserved = RESERVED_CONTEXT_KWARGS &amp; set(context.keys())\n    if overridden_reserved:\n        logger.warning(\n            \"Template keyword argument(s) %s reserved for passing mentions, but already exists.\"\n            \" User provided value will override it.\",\n            \", \".join(f\"`{s}`\" for s in overridden_reserved),\n        )\n\n    messages: list[SlackMessage] = []\n    for recipient in policy.recipients.all():\n        logger.debug(\"Sending message to recipient %s\", recipient)\n\n        # Initialize template instance\n        template = self._get_template_instance_from_policy(policy)\n\n        # Prepare rendering arguments\n        render_context = self._get_default_context(policy=policy, recipient=recipient)\n        render_context.update(context)\n        logger.debug(\"Context prepared as: %r\", render_context)\n\n        # Render template and parse as body\n        rendered = template.render(context=render_context)\n        body = MessageBody.from_any(rendered)\n\n        # Create message instance\n        message = self.prepare_message(policy=policy, channel=recipient.channel, header=header, body=body)\n        messages.append(message)\n\n    return SlackMessage.objects.bulk_create(messages)\n</code></pre>"},{"location":"api-references/slack-messages/messaging-backends/#django_slack_tools.slack_messages.backends.BaseBackend.send_message","title":"<code>send_message(message, *, raise_exception, get_permalink)</code>","text":"<p>Send message.</p> <p>Parameters:</p> Name Type Description Default <code>message</code> <code>SlackMessage</code> <p>Prepared message.</p> required <code>raise_exception</code> <code>bool</code> <p>Whether to propagate exceptions.</p> required <code>get_permalink</code> <code>bool</code> <p>Try to get the message permalink via additional Slack API call.</p> required <p>Returns:</p> Type Description <code>SlackMessage</code> <p>Message sent to Slack.</p> Source code in <code>django_slack_tools/slack_messages/backends/base.py</code> <pre><code>def send_message(\n    self,\n    message: SlackMessage,\n    *,\n    raise_exception: bool,\n    get_permalink: bool,\n) -&gt; SlackMessage:\n    \"\"\"Send message.\n\n    Args:\n        message: Prepared message.\n        raise_exception: Whether to propagate exceptions.\n        get_permalink: Try to get the message permalink via additional Slack API call.\n\n    Returns:\n        Message sent to Slack.\n    \"\"\"\n    try:\n        response: SlackResponse\n        try:\n            response = self._send_message(message)\n        except SlackApiError as err:\n            if raise_exception:\n                raise\n\n            logger.warning(\n                \"Error occurred while sending message but suppressed because `raise_exception` set.\",\n                exc_info=err,\n            )\n            response = err.response\n\n        message.ok = ok = cast(bool, response.get(\"ok\"))\n        if ok:\n            # Get message TS if OK\n            message.ts = cast(str, response.get(\"ts\"))\n\n            # Store thread TS if possible\n            data: dict[str, Any] = response.get(\"message\", {})\n            message.parent_ts = data.get(\"thread_ts\", \"\")\n\n            # Get message permalink\n            if get_permalink:\n                message.permalink = self._get_permalink(message=message, raise_exception=raise_exception)\n\n        message.request = self._record_request(response)\n        message.response = self._record_response(response)\n    except:  # noqa: E722\n        if raise_exception:\n            raise\n\n        logger.exception(\"Error occurred while sending message but suppressed because `raise_exception` set.\")\n        message.exception = traceback.format_exc()\n    finally:\n        message.save()\n\n    message.refresh_from_db()\n    return message\n</code></pre>"},{"location":"api-references/slack-messages/messaging-backends/#django_slack_tools.slack_messages.backends.BaseBackend.send_messages","title":"<code>send_messages(*messages, raise_exception, get_permalink)</code>","text":"<p>Shortcut to send multiple messages.</p> <p>Parameters:</p> Name Type Description Default <code>messages</code> <code>SlackMessage</code> <p>Messages to send.</p> <code>()</code> <code>raise_exception</code> <code>bool</code> <p>Whether to propagate exceptions.</p> required <code>get_permalink</code> <code>bool</code> <p>Try to get the message permalink via additional Slack API call.</p> required <p>Returns:</p> Type Description <code>int</code> <p>Count of messages sent successfully.</p> Source code in <code>django_slack_tools/slack_messages/backends/base.py</code> <pre><code>def send_messages(self, *messages: SlackMessage, raise_exception: bool, get_permalink: bool) -&gt; int:\n    \"\"\"Shortcut to send multiple messages.\n\n    Args:\n        messages: Messages to send.\n        raise_exception: Whether to propagate exceptions.\n        get_permalink: Try to get the message permalink via additional Slack API call.\n\n    Returns:\n        Count of messages sent successfully.\n    \"\"\"\n    num_sent = 0\n    for message in messages:\n        sent = self.send_message(message=message, raise_exception=raise_exception, get_permalink=get_permalink)\n        num_sent += 1 if sent.ok else 0\n\n    return num_sent\n</code></pre>"},{"location":"api-references/slack-messages/messaging-backends/#django_slack_tools.slack_messages.backends.DummyBackend","title":"<code>DummyBackend</code>","text":"<p>               Bases: <code>BaseBackend</code></p> <p>An dummy backend that does nothing with message.</p> Source code in <code>django_slack_tools/slack_messages/backends/dummy.py</code> <pre><code>class DummyBackend(BaseBackend):\n    \"\"\"An dummy backend that does nothing with message.\"\"\"\n\n    def prepare_message(self, *args: Any, **kwargs: Any) -&gt; SlackMessage:  # noqa: D102, ARG002\n        return SlackMessage(header={}, body={})\n\n    def _send_message(self, *args: Any, **kwargs: Any) -&gt; SlackResponse:  # noqa: ARG002\n        return SlackResponse(\n            client=None,\n            http_verb=\"POST\",\n            api_url=\"https://www.slack.com/api/chat.postMessage\",\n            req_args={},\n            data={\"ok\": True},\n            headers={},\n            status_code=200,\n        )\n\n    def _get_permalink(self, *, message: SlackMessage, raise_exception: bool) -&gt; str:  # noqa: ARG002\n        return \"\"\n\n    def _record_request(self, *args: Any, **kwargs: Any) -&gt; Any: ...\n\n    def _record_response(self, *args: Any, **kwargs: Any) -&gt; Any: ...\n</code></pre>"},{"location":"api-references/slack-messages/messaging-backends/#django_slack_tools.slack_messages.backends.LoggingBackend","title":"<code>LoggingBackend</code>","text":"<p>               Bases: <code>DummyBackend</code></p> <p>Backend that log the message rather than sending it.</p> Source code in <code>django_slack_tools/slack_messages/backends/logging.py</code> <pre><code>class LoggingBackend(DummyBackend):\n    \"\"\"Backend that log the message rather than sending it.\"\"\"\n\n    def _send_message(self, *args: Any, **kwargs: Any) -&gt; SlackResponse:\n        logger.debug(\"Sending an message with following args=%r, kwargs=%r\", args, kwargs)\n        return super()._send_message(*args, **kwargs)\n\n    def _record_request(self, *args: Any, **kwargs: Any) -&gt; Any:\n        logger.debug(\"Recording request with args=%r, kwargs=%r\", args, kwargs)\n\n    def _record_response(self, *args: Any, **kwargs: Any) -&gt; Any:\n        logger.debug(\"Recording response with args=%r, kwargs=%r\", args, kwargs)\n</code></pre>"},{"location":"api-references/slack-messages/messaging-backends/#django_slack_tools.slack_messages.backends.SlackBackend","title":"<code>SlackBackend</code>","text":"<p>               Bases: <code>BaseBackend</code></p> <p>Backend actually sending the messages.</p> Source code in <code>django_slack_tools/slack_messages/backends/slack.py</code> <pre><code>class SlackBackend(BaseBackend):\n    \"\"\"Backend actually sending the messages.\"\"\"\n\n    def __init__(\n        self,\n        *,\n        slack_app: App | Callable[[], App] | str,\n    ) -&gt; None:\n        \"\"\"Initialize backend.\n\n        Args:\n            slack_app: Slack app instance or import string.\n        \"\"\"\n        if isinstance(slack_app, str):\n            slack_app = import_string(slack_app)\n\n        if callable(slack_app):\n            slack_app = slack_app()\n\n        if not isinstance(slack_app, App):\n            msg = \"Couldn't resolve provided app spec into Slack app instance.\"\n            raise ImproperlyConfigured(msg)\n\n        self._slack_app = slack_app\n\n    def _send_message(self, message: SlackMessage) -&gt; SlackResponse:\n        header = message.header or {}\n        body = message.body or {}\n        return self._slack_app.client.chat_postMessage(channel=message.channel, **header, **body)\n\n    def _get_permalink(self, *, message: SlackMessage, raise_exception: bool = False) -&gt; str:\n        \"\"\"Get a permalink for given message identifier.\"\"\"\n        if not message.ts:\n            msg = \"Message timestamp is not set, can't retrieve permalink.\"\n            raise ValueError(msg)\n\n        try:\n            _permalink_resp = self._slack_app.client.chat_getPermalink(\n                channel=message.channel,\n                message_ts=message.ts,\n            )\n        except SlackApiError:\n            if raise_exception:\n                raise\n\n            logger.exception(\n                \"Error occurred while sending retrieving message's permalink,\"\n                \" but ignored as `raise_exception` not set.\",\n            )\n            return \"\"\n\n        return _permalink_resp.get(\"permalink\", default=\"\")\n\n    def _record_request(self, response: SlackResponse) -&gt; dict[str, Any]:\n        # Remove auth header (token) from request before recording\n        response.req_args.get(\"headers\", {}).pop(\"Authorization\", None)\n\n        return response.req_args\n\n    def _record_response(self, response: SlackResponse) -&gt; dict[str, Any]:\n        return {\n            \"http_verb\": response.http_verb,\n            \"api_url\": response.api_url,\n            \"status_code\": response.status_code,\n            \"headers\": response.headers,\n            \"data\": response.data,\n        }\n</code></pre>"},{"location":"api-references/slack-messages/messaging-backends/#django_slack_tools.slack_messages.backends.SlackBackend.__init__","title":"<code>__init__(*, slack_app)</code>","text":"<p>Initialize backend.</p> <p>Parameters:</p> Name Type Description Default <code>slack_app</code> <code>App | Callable[[], App] | str</code> <p>Slack app instance or import string.</p> required Source code in <code>django_slack_tools/slack_messages/backends/slack.py</code> <pre><code>def __init__(\n    self,\n    *,\n    slack_app: App | Callable[[], App] | str,\n) -&gt; None:\n    \"\"\"Initialize backend.\n\n    Args:\n        slack_app: Slack app instance or import string.\n    \"\"\"\n    if isinstance(slack_app, str):\n        slack_app = import_string(slack_app)\n\n    if callable(slack_app):\n        slack_app = slack_app()\n\n    if not isinstance(slack_app, App):\n        msg = \"Couldn't resolve provided app spec into Slack app instance.\"\n        raise ImproperlyConfigured(msg)\n\n    self._slack_app = slack_app\n</code></pre>"},{"location":"api-references/slack-messages/messaging-backends/#django_slack_tools.slack_messages.backends.SlackBackend._get_permalink","title":"<code>_get_permalink(*, message, raise_exception=False)</code>","text":"<p>Get a permalink for given message identifier.</p> Source code in <code>django_slack_tools/slack_messages/backends/slack.py</code> <pre><code>def _get_permalink(self, *, message: SlackMessage, raise_exception: bool = False) -&gt; str:\n    \"\"\"Get a permalink for given message identifier.\"\"\"\n    if not message.ts:\n        msg = \"Message timestamp is not set, can't retrieve permalink.\"\n        raise ValueError(msg)\n\n    try:\n        _permalink_resp = self._slack_app.client.chat_getPermalink(\n            channel=message.channel,\n            message_ts=message.ts,\n        )\n    except SlackApiError:\n        if raise_exception:\n            raise\n\n        logger.exception(\n            \"Error occurred while sending retrieving message's permalink,\"\n            \" but ignored as `raise_exception` not set.\",\n        )\n        return \"\"\n\n    return _permalink_resp.get(\"permalink\", default=\"\")\n</code></pre>"},{"location":"api-references/slack-messages/messaging-backends/#django_slack_tools.slack_messages.backends.SlackRedirectBackend","title":"<code>SlackRedirectBackend</code>","text":"<p>               Bases: <code>SlackBackend</code></p> <p>Inherited Slack backend with redirection to specific channels.</p> Source code in <code>django_slack_tools/slack_messages/backends/slack.py</code> <pre><code>class SlackRedirectBackend(SlackBackend):\n    \"\"\"Inherited Slack backend with redirection to specific channels.\"\"\"\n\n    def __init__(self, *, slack_app: App | str, redirect_channel: str, inform_redirect: bool = True) -&gt; None:\n        \"\"\"Initialize backend.\n\n        Args:\n            slack_app: Slack app instance or import string.\n            redirect_channel: Slack channel to redirect.\n            inform_redirect: Whether to append an attachment informing that the message has been redirected.\n                Defaults to `True`.\n        \"\"\"\n        self.redirect_channel = redirect_channel\n        self.inform_redirect = inform_redirect\n\n        super().__init__(slack_app=slack_app)\n\n    def prepare_message(self, *args: Any, channel: str, body: MessageBody, **kwargs: Any) -&gt; SlackMessage:\n        \"\"\"Prepare message to send, with modified for redirection.\n\n        Args:\n            args: Positional arguments to pass to super method.\n            channel: Original channel to send message.\n            body: Message content.\n            kwargs: Keyword arguments to pass to super method.\n\n        Returns:\n            Prepared message instance.\n        \"\"\"\n        # Modify channel to force messages always sent to specific channel\n        # Add an attachment that informing message has been redirected\n        if self.inform_redirect:\n            body.attachments = [\n                self._make_inform_attachment(original_channel=channel),\n                *(body.attachments or []),\n            ]\n\n        return super().prepare_message(*args, channel=self.redirect_channel, body=body, **kwargs)\n\n    def _make_inform_attachment(self, *, original_channel: str) -&gt; dict[str, Any]:\n        msg_redirect_inform = _(\n            \":warning:  This message was originally sent to channel *{channel}* but redirected here.\",\n        )\n\n        return {\n            \"color\": \"#eb4034\",\n            \"text\": msg_redirect_inform.format(channel=original_channel),\n        }\n</code></pre>"},{"location":"api-references/slack-messages/messaging-backends/#django_slack_tools.slack_messages.backends.SlackRedirectBackend.__init__","title":"<code>__init__(*, slack_app, redirect_channel, inform_redirect=True)</code>","text":"<p>Initialize backend.</p> <p>Parameters:</p> Name Type Description Default <code>slack_app</code> <code>App | str</code> <p>Slack app instance or import string.</p> required <code>redirect_channel</code> <code>str</code> <p>Slack channel to redirect.</p> required <code>inform_redirect</code> <code>bool</code> <p>Whether to append an attachment informing that the message has been redirected. Defaults to <code>True</code>.</p> <code>True</code> Source code in <code>django_slack_tools/slack_messages/backends/slack.py</code> <pre><code>def __init__(self, *, slack_app: App | str, redirect_channel: str, inform_redirect: bool = True) -&gt; None:\n    \"\"\"Initialize backend.\n\n    Args:\n        slack_app: Slack app instance or import string.\n        redirect_channel: Slack channel to redirect.\n        inform_redirect: Whether to append an attachment informing that the message has been redirected.\n            Defaults to `True`.\n    \"\"\"\n    self.redirect_channel = redirect_channel\n    self.inform_redirect = inform_redirect\n\n    super().__init__(slack_app=slack_app)\n</code></pre>"},{"location":"api-references/slack-messages/messaging-backends/#django_slack_tools.slack_messages.backends.SlackRedirectBackend.prepare_message","title":"<code>prepare_message(*args, channel, body, **kwargs)</code>","text":"<p>Prepare message to send, with modified for redirection.</p> <p>Parameters:</p> Name Type Description Default <code>args</code> <code>Any</code> <p>Positional arguments to pass to super method.</p> <code>()</code> <code>channel</code> <code>str</code> <p>Original channel to send message.</p> required <code>body</code> <code>MessageBody</code> <p>Message content.</p> required <code>kwargs</code> <code>Any</code> <p>Keyword arguments to pass to super method.</p> <code>{}</code> <p>Returns:</p> Type Description <code>SlackMessage</code> <p>Prepared message instance.</p> Source code in <code>django_slack_tools/slack_messages/backends/slack.py</code> <pre><code>def prepare_message(self, *args: Any, channel: str, body: MessageBody, **kwargs: Any) -&gt; SlackMessage:\n    \"\"\"Prepare message to send, with modified for redirection.\n\n    Args:\n        args: Positional arguments to pass to super method.\n        channel: Original channel to send message.\n        body: Message content.\n        kwargs: Keyword arguments to pass to super method.\n\n    Returns:\n        Prepared message instance.\n    \"\"\"\n    # Modify channel to force messages always sent to specific channel\n    # Add an attachment that informing message has been redirected\n    if self.inform_redirect:\n        body.attachments = [\n            self._make_inform_attachment(original_channel=channel),\n            *(body.attachments or []),\n        ]\n\n    return super().prepare_message(*args, channel=self.redirect_channel, body=body, **kwargs)\n</code></pre>"},{"location":"api-references/slack-messages/models/","title":"Models","text":""},{"location":"api-references/slack-messages/models/#django_slack_tools.slack_messages.models","title":"<code>django_slack_tools.slack_messages.models</code>","text":""},{"location":"api-references/slack-messages/models/#django_slack_tools.slack_messages.models.SlackMention","title":"<code>SlackMention</code>","text":"<p>               Bases: <code>TimestampMixin</code>, <code>Model</code></p> <p>People or group in channels receive messages.</p> Source code in <code>django_slack_tools/slack_messages/models/mention.py</code> <pre><code>class SlackMention(TimestampMixin, models.Model):\n    \"\"\"People or group in channels receive messages.\"\"\"\n\n    class MentionType(models.TextChoices):\n        \"\"\"Possible mention types.\"\"\"\n\n        USER = \"U\", _(\"User\")\n        \"User mentions. e.g. `@lasuillard`.\"\n\n        GROUP = \"G\", _(\"Group\")\n        \"Team mentions. e.g. `@backend`.\"\n\n        SPECIAL = \"S\", _(\"Special\")\n        \"Special mentions. e.g. `@here`, `@channel`, `@everyone`.\"\n\n        UNKNOWN = \"?\", _(\"Unknown\")\n        \"Unknown mention type.\"\n\n    type = models.CharField(\n        verbose_name=_(\"Type\"),\n        help_text=_(\"Type of mentions.\"),\n        max_length=1,\n        choices=MentionType.choices,\n        blank=False,\n    )\n    name = models.CharField(\n        verbose_name=_(\"Name\"),\n        help_text=_(\"Human-friendly mention name.\"),\n        max_length=128,\n    )\n    mention_id = models.CharField(\n        verbose_name=_(\"Mention ID\"),\n        help_text=_(\"User or group ID, or raw mention itself.\"),\n        max_length=32,\n    )\n\n    objects: SlackMentionManager = SlackMentionManager()\n\n    class Meta:  # noqa: D106\n        verbose_name = _(\"Mention\")\n        verbose_name_plural = _(\"Mentions\")\n\n    def __str__(self) -&gt; str:\n        return _(\"{name} ({type}, {mention_id})\").format(\n            name=self.name,\n            type=self.get_type_display(),\n            mention_id=self.mention_id,\n        )\n\n    @property\n    def mention(self) -&gt; str:\n        \"\"\"Mention string for use in messages, e.g. `\"&lt;@{USER_ID}&gt;\"`.\"\"\"\n        if self.type == SlackMention.MentionType.USER:\n            return f\"&lt;@{self.mention_id}&gt;\"\n\n        if self.type == SlackMention.MentionType.GROUP:\n            return f\"&lt;!subteam^{self.mention_id}&gt;\"\n\n        return self.mention_id\n</code></pre>"},{"location":"api-references/slack-messages/models/#django_slack_tools.slack_messages.models.SlackMention.mention","title":"<code>mention</code>  <code>property</code>","text":"<p>Mention string for use in messages, e.g. <code>\"&lt;@{USER_ID}&gt;\"</code>.</p>"},{"location":"api-references/slack-messages/models/#django_slack_tools.slack_messages.models.SlackMention.MentionType","title":"<code>MentionType</code>","text":"<p>               Bases: <code>TextChoices</code></p> <p>Possible mention types.</p> Source code in <code>django_slack_tools/slack_messages/models/mention.py</code> <pre><code>class MentionType(models.TextChoices):\n    \"\"\"Possible mention types.\"\"\"\n\n    USER = \"U\", _(\"User\")\n    \"User mentions. e.g. `@lasuillard`.\"\n\n    GROUP = \"G\", _(\"Group\")\n    \"Team mentions. e.g. `@backend`.\"\n\n    SPECIAL = \"S\", _(\"Special\")\n    \"Special mentions. e.g. `@here`, `@channel`, `@everyone`.\"\n\n    UNKNOWN = \"?\", _(\"Unknown\")\n    \"Unknown mention type.\"\n</code></pre>"},{"location":"api-references/slack-messages/models/#django_slack_tools.slack_messages.models.SlackMention.MentionType.GROUP","title":"<code>GROUP = ('G', _('Group'))</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>Team mentions. e.g. <code>@backend</code>.</p>"},{"location":"api-references/slack-messages/models/#django_slack_tools.slack_messages.models.SlackMention.MentionType.SPECIAL","title":"<code>SPECIAL = ('S', _('Special'))</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>Special mentions. e.g. <code>@here</code>, <code>@channel</code>, <code>@everyone</code>.</p>"},{"location":"api-references/slack-messages/models/#django_slack_tools.slack_messages.models.SlackMention.MentionType.UNKNOWN","title":"<code>UNKNOWN = ('?', _('Unknown'))</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>Unknown mention type.</p>"},{"location":"api-references/slack-messages/models/#django_slack_tools.slack_messages.models.SlackMention.MentionType.USER","title":"<code>USER = ('U', _('User'))</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>User mentions. e.g. <code>@lasuillard</code>.</p>"},{"location":"api-references/slack-messages/models/#django_slack_tools.slack_messages.models.SlackMessage","title":"<code>SlackMessage</code>","text":"<p>               Bases: <code>TimestampMixin</code>, <code>Model</code></p> <p>An Slack message.</p> Source code in <code>django_slack_tools/slack_messages/models/message.py</code> <pre><code>class SlackMessage(TimestampMixin, models.Model):\n    \"\"\"An Slack message.\"\"\"\n\n    policy = models.ForeignKey(\n        SlackMessagingPolicy,\n        verbose_name=_(\"Messaging Policy\"),\n        help_text=_(\"Messaging policy for this message.\"),\n        null=True,  # Message can be built from scratch without using templates\n        blank=True,\n        on_delete=models.SET_NULL,\n    )\n    channel = models.CharField(\n        verbose_name=_(\"Channel\"),\n        help_text=_(\"ID of channel this message sent to.\"),\n        blank=False,\n        max_length=128,  # Maximum length of channel name is 80 characters\n    )\n    header = models.JSONField(\n        verbose_name=_(\"Header\"),\n        help_text=_(\n            \"Slack control arguments.\"\n            \" Allowed fields are `mrkdwn`, `parse`, `reply_broadcast`, `thread_ts`, `unfurl_links`, `unfurl_media`.\",\n        ),\n        validators=[header_validator],\n    )\n    body = models.JSONField(\n        verbose_name=_(\"Body\"),\n        help_text=_(\n            \"Message body.\"\n            \" Allowed fields are `attachments`, `body`, `text`, `icon_emoji`, `icon_url`, `metadata`, `username`.\",\n        ),\n        validators=[body_validator],\n    )\n    ok = models.BooleanField(\n        verbose_name=_(\"OK\"),\n        help_text=_(\"Whether Slack API respond with OK. If never sent, will be `null`.\"),\n        null=True,\n        default=None,\n    )\n    permalink = models.CharField(\n        verbose_name=_(\"Permalink\"),\n        help_text=_(\"Permanent link for this message.\"),\n        max_length=256,\n        default=\"\",\n        blank=True,\n    )\n\n    # As ID, `ts` assigned by Slack, it is known after received response\n    # By known, `ts` refers to timestamp (Format of `datetime.timestamp()`, e.g. `\"1702737142.945359\"`)\n    ts = models.CharField(\n        verbose_name=_(\"Message ID\"),\n        help_text=_(\"ID of an Slack message.\"),\n        max_length=32,\n        null=True,\n        blank=True,\n        unique=True,\n    )\n    parent_ts = models.CharField(\n        verbose_name=_(\"Thread ID\"),\n        help_text=_(\"ID of current conversation thread.\"),\n        max_length=32,\n        default=\"\",\n        blank=True,\n    )\n\n    # Extraneous call detail for debugging\n    request = models.JSONField(\n        verbose_name=_(\"Request\"),\n        help_text=_(\"Dump of request content for debugging.\"),\n        null=True,\n        blank=True,\n    )\n    response = models.JSONField(\n        verbose_name=_(\"Response\"),\n        help_text=_(\"Dump of response content for debugging.\"),\n        null=True,\n        blank=True,\n    )\n    exception = models.TextField(\n        verbose_name=_(\"Exception\"),\n        help_text=_(\"Exception message if any.\"),\n        blank=True,\n    )\n\n    objects: SlackMessageManager = SlackMessageManager()\n\n    class Meta:  # noqa: D106\n        verbose_name = _(\"Message\")\n        verbose_name_plural = _(\"Messages\")\n        ordering = (\"-created\",)\n\n    def __str__(self) -&gt; str:\n        if self.ok is True:\n            return _(\"Message ({ts}, OK)\").format(id=self.id, ts=self.ts)\n\n        if self.ok is False:\n            return _(\"Message ({id}, not OK)\").format(id=self.id)\n\n        return _(\"Message ({id}, not sent)\").format(id=self.id)\n</code></pre>"},{"location":"api-references/slack-messages/models/#django_slack_tools.slack_messages.models.SlackMessageRecipient","title":"<code>SlackMessageRecipient</code>","text":"<p>               Bases: <code>TimestampMixin</code>, <code>Model</code></p> <p>People or group in channels receive messages.</p> Source code in <code>django_slack_tools/slack_messages/models/message_recipient.py</code> <pre><code>class SlackMessageRecipient(TimestampMixin, models.Model):\n    \"\"\"People or group in channels receive messages.\"\"\"\n\n    alias = models.CharField(\n        verbose_name=_(\"Alias\"),\n        help_text=_(\"Alias for this recipient.\"),\n        max_length=256,\n        unique=True,\n    )\n    channel = models.CharField(\n        verbose_name=_(\"Channel\"),\n        help_text=_(\"Slack channel ID where messages will be sent.\"),\n        max_length=128,\n        blank=False,\n    )\n    channel_name = models.CharField(\n        verbose_name=_(\"Channel name\"),\n        help_text=_(\"Display name of channel.\"),\n        max_length=256,\n        blank=True,\n        default=\"\",\n    )\n    mentions = models.ManyToManyField(\n        SlackMention,\n        verbose_name=_(\"Mentions\"),\n        help_text=_(\"List of mentions.\"),\n        blank=True,\n    )\n\n    objects: SlackMessageRecipientManager = SlackMessageRecipientManager()\n\n    class Meta:  # noqa: D106\n        verbose_name = _(\"Recipient\")\n        verbose_name_plural = _(\"Recipients\")\n\n    def __str__(self) -&gt; str:\n        num_mentions = self.mentions.count()\n\n        return _(\"{alias} ({channel}, {num_mentions} mentions)\").format(\n            alias=self.alias,\n            channel=self.channel,\n            num_mentions=num_mentions,\n        )\n</code></pre>"},{"location":"api-references/slack-messages/models/#django_slack_tools.slack_messages.models.SlackMessagingPolicy","title":"<code>SlackMessagingPolicy</code>","text":"<p>               Bases: <code>TimestampMixin</code>, <code>Model</code></p> <p>An Slack messaging policy which determines message content and those who receive messages.</p> Source code in <code>django_slack_tools/slack_messages/models/messaging_policy.py</code> <pre><code>class SlackMessagingPolicy(TimestampMixin, models.Model):\n    \"\"\"An Slack messaging policy which determines message content and those who receive messages.\"\"\"\n\n    class TemplateType(models.TextChoices):\n        \"\"\"Possible template types.\"\"\"\n\n        DICT = \"D\", _(\"Dictionary\")\n        \"Dictionary-based template.\"\n\n        DJANGO = \"DJ\", _(\"Django\")\n        \"Django XML-based template.\"\n\n        DJANGO_INLINE = \"DI\", _(\"Django Inline\")\n        \"Django inline template.\"\n\n        UNKNOWN = \"?\", _(\"Unknown\")\n        \"Unknown template type.\"\n\n    code = models.CharField(\n        verbose_name=_(\"Code\"),\n        help_text=_(\"Unique message code for lookup, mostly by human.\"),\n        max_length=32,\n        unique=True,\n    )\n    enabled = models.BooleanField(\n        verbose_name=_(\"Enabled\"),\n        help_text=_(\"Turn on or off current messaging policy.\"),\n        default=True,\n    )\n    recipients = models.ManyToManyField(\n        SlackMessageRecipient,\n        verbose_name=_(\"Message recipients\"),\n        help_text=_(\"Those who will receive messages.\"),\n    )\n    header_defaults = models.JSONField(\n        verbose_name=_(\"Default header\"),\n        help_text=_(\"Default header values applied to messages on creation.\"),\n        validators=[header_validator],\n        blank=True,\n        default=dict,\n    )\n    template_type = models.CharField(\n        verbose_name=_(\"Template type\"),\n        help_text=_(\"Type of message template.\"),\n        max_length=2,\n        choices=TemplateType.choices,\n        default=TemplateType.DICT,\n    )\n    template: models.JSONField[Any] = models.JSONField(\n        verbose_name=_(\"Message template object\"),\n        help_text=_(\"Dictionary-based template object.\"),\n        null=True,\n        blank=True,\n    )\n\n    # Type is too obvious but due to limits...\n    objects: SlackMessagingPolicyManager = SlackMessagingPolicyManager()\n\n    class Meta:  # noqa: D106\n        verbose_name = _(\"Messaging Policy\")\n        verbose_name_plural = _(\"Messaging Policies\")\n\n    def __str__(self) -&gt; str:\n        num_recipients = self.recipients.all().count()\n        if self.enabled:\n            return _(\"{code} (enabled, {num_recipients} recipients)\").format(\n                code=self.code,\n                num_recipients=num_recipients,\n            )\n\n        return _(\"{code} (disabled, {num_recipients} recipients)\").format(code=self.code, num_recipients=num_recipients)\n</code></pre>"},{"location":"api-references/slack-messages/models/#django_slack_tools.slack_messages.models.SlackMessagingPolicy.TemplateType","title":"<code>TemplateType</code>","text":"<p>               Bases: <code>TextChoices</code></p> <p>Possible template types.</p> Source code in <code>django_slack_tools/slack_messages/models/messaging_policy.py</code> <pre><code>class TemplateType(models.TextChoices):\n    \"\"\"Possible template types.\"\"\"\n\n    DICT = \"D\", _(\"Dictionary\")\n    \"Dictionary-based template.\"\n\n    DJANGO = \"DJ\", _(\"Django\")\n    \"Django XML-based template.\"\n\n    DJANGO_INLINE = \"DI\", _(\"Django Inline\")\n    \"Django inline template.\"\n\n    UNKNOWN = \"?\", _(\"Unknown\")\n    \"Unknown template type.\"\n</code></pre>"},{"location":"api-references/slack-messages/models/#django_slack_tools.slack_messages.models.SlackMessagingPolicy.TemplateType.DICT","title":"<code>DICT = ('D', _('Dictionary'))</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>Dictionary-based template.</p>"},{"location":"api-references/slack-messages/models/#django_slack_tools.slack_messages.models.SlackMessagingPolicy.TemplateType.DJANGO","title":"<code>DJANGO = ('DJ', _('Django'))</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>Django XML-based template.</p>"},{"location":"api-references/slack-messages/models/#django_slack_tools.slack_messages.models.SlackMessagingPolicy.TemplateType.DJANGO_INLINE","title":"<code>DJANGO_INLINE = ('DI', _('Django Inline'))</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>Django inline template.</p>"},{"location":"api-references/slack-messages/models/#django_slack_tools.slack_messages.models.SlackMessagingPolicy.TemplateType.UNKNOWN","title":"<code>UNKNOWN = ('?', _('Unknown'))</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>Unknown template type.</p>"},{"location":"api-references/slack-messages/sending-messages/","title":"Sending Messages","text":""},{"location":"api-references/slack-messages/sending-messages/#django_slack_tools.slack_messages.message","title":"<code>django_slack_tools.slack_messages.message</code>","text":"<p>Handy APIs for sending Slack messages.</p>"},{"location":"api-references/slack-messages/sending-messages/#django_slack_tools.slack_messages.message.slack_message","title":"<code>slack_message(body, *, channel, header=None, raise_exception=False, get_permalink=False, backend=app_settings.backend)</code>","text":"<p>Send a simple text message.</p> <p>Parameters:</p> Name Type Description Default <code>body</code> <code>str | MessageBody | dict[str, Any]</code> <p>Message content, simple message or full request body.</p> required <code>channel</code> <code>str</code> <p>Channel to send message.</p> required <code>header</code> <code>MessageHeader | dict[str, Any] | None</code> <p>Slack message control header.</p> <code>None</code> <code>raise_exception</code> <code>bool</code> <p>Whether to re-raise caught exception while sending messages.</p> <code>False</code> <code>get_permalink</code> <code>bool</code> <p>Try to get the message permalink via extraneous Slack API calls.</p> <code>False</code> <code>backend</code> <code>BaseBackend</code> <p>Messaging backend. If not set, use <code>app_settings.backend</code>.</p> <code>backend</code> <p>Returns:</p> Type Description <code>SlackMessage</code> <p>Sent message instance or <code>None</code>.</p> Source code in <code>django_slack_tools/slack_messages/message.py</code> <pre><code>def slack_message(  # noqa: PLR0913\n    body: str | MessageBody | dict[str, Any],\n    *,\n    channel: str,\n    header: MessageHeader | dict[str, Any] | None = None,\n    raise_exception: bool = False,\n    get_permalink: bool = False,\n    backend: BaseBackend = app_settings.backend,\n) -&gt; SlackMessage:\n    \"\"\"Send a simple text message.\n\n    Args:\n        body: Message content, simple message or full request body.\n        channel: Channel to send message.\n        header: Slack message control header.\n        raise_exception: Whether to re-raise caught exception while sending messages.\n        get_permalink: Try to get the message permalink via extraneous Slack API calls.\n        backend: Messaging backend. If not set, use `app_settings.backend`.\n\n    Returns:\n        Sent message instance or `None`.\n    \"\"\"\n    body = MessageBody.from_any(body)\n    header = MessageHeader.from_any(header)\n    message = backend.prepare_message(channel=channel, header=header, body=body)\n\n    return backend.send_message(message, raise_exception=raise_exception, get_permalink=get_permalink)\n</code></pre>"},{"location":"api-references/slack-messages/sending-messages/#django_slack_tools.slack_messages.message.slack_message_via_policy","title":"<code>slack_message_via_policy(policy=app_settings.default_policy_code, *, header=None, raise_exception=False, lazy=False, get_permalink=False, context=None, backend=app_settings.backend)</code>","text":"<p>Send a simple text message.</p> <p>Some default context variables are populated and available for use in templates. See corresponding backend implementation for available context variables.</p> <p>Parameters:</p> Name Type Description Default <code>policy</code> <code>str | SlackMessagingPolicy</code> <p>Messaging policy code or policy instance. Defaults to app's default policy.</p> <code>default_policy_code</code> <code>header</code> <code>MessageHeader | dict[str, Any] | None</code> <p>Slack message control header.</p> <code>None</code> <code>raise_exception</code> <code>bool</code> <p>Whether to re-raise caught exception while sending messages.</p> <code>False</code> <code>lazy</code> <code>bool</code> <p>Decide whether try create policy with disabled, if not exists.</p> <code>False</code> <code>get_permalink</code> <code>bool</code> <p>Try to get the message permalink via extraneous Slack API calls.</p> <code>False</code> <code>context</code> <code>dict[str, Any] | None</code> <p>Dictionary to pass to template for rendering.</p> <code>None</code> <code>backend</code> <code>BaseBackend</code> <p>Messaging backend. If not set, use <code>app_settings.backend</code>.</p> <code>backend</code> <p>Returns:</p> Type Description <code>int</code> <p>Count of messages sent successfully.</p> <p>Raises:</p> Type Description <code>DoesNotExist</code> <p>Policy for given code does not exists.</p> Source code in <code>django_slack_tools/slack_messages/message.py</code> <pre><code>def slack_message_via_policy(  # noqa: PLR0913\n    policy: str | SlackMessagingPolicy = app_settings.default_policy_code,\n    *,\n    header: MessageHeader | dict[str, Any] | None = None,\n    raise_exception: bool = False,\n    lazy: bool = False,\n    get_permalink: bool = False,\n    context: dict[str, Any] | None = None,\n    backend: BaseBackend = app_settings.backend,\n) -&gt; int:\n    \"\"\"Send a simple text message.\n\n    Some default context variables are populated and available for use in templates.\n    See corresponding backend implementation for available context variables.\n\n    Args:\n        policy: Messaging policy code or policy instance. Defaults to app's default policy.\n        header: Slack message control header.\n        raise_exception: Whether to re-raise caught exception while sending messages.\n        lazy: Decide whether try create policy with disabled, if not exists.\n        get_permalink: Try to get the message permalink via extraneous Slack API calls.\n        context: Dictionary to pass to template for rendering.\n        backend: Messaging backend. If not set, use `app_settings.backend`.\n\n    Returns:\n        Count of messages sent successfully.\n\n    Raises:\n        SlackMessagingPolicy.DoesNotExist: Policy for given code does not exists.\n    \"\"\"\n    if isinstance(policy, str):\n        if lazy:\n            policy, created = SlackMessagingPolicy.objects.get_or_create(\n                code=policy,\n                defaults={\n                    \"enabled\": app_settings.lazy_policy_enabled,\n                    \"template\": app_settings.default_template,\n                },\n            )\n            if created:\n                # Add default recipient for created policy\n                recipient = SlackMessageRecipient.objects.get(alias=app_settings.default_recipient)\n                policy.recipients.add(recipient)\n                logger.warning(\"Policy for code %r created because `lazy` is set.\", policy)\n        else:\n            policy = SlackMessagingPolicy.objects.get(code=policy)\n\n    header = MessageHeader.from_any(header)\n    context = context or {}\n\n    messages = backend.prepare_messages_from_policy(policy, header=header, context=context)\n    if not policy.enabled:\n        logger.warning(\n            \"Created %d messages but not sending because policy %s is not enabled.\",\n            len(messages),\n            policy.code,\n        )\n        return 0\n\n    return backend.send_messages(*messages, raise_exception=raise_exception, get_permalink=get_permalink)\n</code></pre>"},{"location":"tutorials/quick-start/","title":"Quick Start","text":""},{"location":"tutorials/quick-start/#installation","title":"Installation","text":"<p>django-slack-tools supports Python 3.8+ and Django 3.2+. Supports for each deps will be dropped as soon as the ends of security updates.</p> <p>Install the package:</p> <pre><code>$ pip install django-slack-tools\n</code></pre> <p>Add the app to the your Django settings:</p> <pre><code>INSTALLED_APPS = [\n    ...\n    \"django.contrib.messages\", # Used in admin\n    \"django_slack_tools.slack_messages\",\n    ...\n]\n</code></pre> <p>Add configuration for application:</p> <pre><code>DJANGO_SLACK_TOOLS = {\n    # Module path to Slack Bolt application or callable returns the app\n    \"SLACK_APP\": \"path.to.your.slack.app\",\n\n    # Messaging backend configuration\n    \"BACKEND\": {\n        \"NAME\": \"django_slack_tools.slack_messages.backends.SlackBackend\",\n        \"OPTIONS\": {\n            \"slack_app\": \"path.to.your.slack.app\",\n        }\n    }\n}\n</code></pre> <p>Then, run the database migration (<code>python manage.py migrate</code>) and send messages:</p> <pre><code>from django_slack_tools.slack_messages.message import slack_message\n\nmessage = slack_message(\n    \"I like threading\",\n    channel=\"id-of-channel\",\n    header={\"reply_broadcast\": True},\n)\n</code></pre> <p>Check examples for about more detailed usage examples.</p>"}]}