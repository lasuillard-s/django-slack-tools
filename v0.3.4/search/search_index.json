{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"django-slack-tools","text":"<p>Little helpers working with Slack bot \ud83e\udd16 in Django.</p> <p>This project aims to implementing helpful features making Slack bot and providing reusable Django apps integrated with database.</p>"},{"location":"#features","title":"\u2728 Features","text":"<p>Key features are:</p> <ul> <li> <p> Reusable Django app for Slack messaging with various messaging backends for different environments</p> </li> <li> <p> Database-backed Slack messaging policies with simple dictionary-based template</p> </li> <li> <p> Message histories</p> </li> <li> <p> Built-in admin for management working with Slack workspace</p> </li> <li> <p> Celery support for messaging backends, management and shortcut tasks, etc.</p> </li> <li> <p> Django template support</p> </li> </ul> <p>And more in future roadmap...</p> <ul> <li> <p> New Django apps and helpers for Slack features such as modals, event subscription, etc.</p> </li> <li> <p> More fine working example with rich documentation</p> </li> </ul> <p>Currently it is focused on messaging features. In future, hoping to bring more helpful features across Slack Bot ecosystem, such as event subscriptions, modals, bot interactions, etc.</p>"},{"location":"#documentation","title":"\ud83d\uddde\ufe0f Documentation","text":"<p>Please check the documentation for more details.</p>"},{"location":"#contributing","title":"\ud83d\udc96 Contributing","text":"<p>All contributions and helps are welcome. Please check the CONTRIBUTING.md file for about details.</p>"},{"location":"#license","title":"\ud83d\udcdc License","text":"<p>This project is licensed under the terms of the MIT license.</p>"},{"location":"quick-start/","title":"Quick Start","text":""},{"location":"quick-start/#installation","title":"\ud83d\ude80 Installation","text":"<p>django-slack-tools supports Python 3.9+ and Django 4.2+. Supports for each deps will be dropped as soon as the ends of security updates.</p> <p>[!WARNING] 0.x versions are for development. Breaking changes can be made at any time. If gonna use this package, recommend to pin down the version.</p> <p>Install the package:</p> <pre><code>$ pip install django-slack-tools\n</code></pre> <p>Add the app to the your Django settings:</p> <pre><code>INSTALLED_APPS = [\n    ...\n    \"django.contrib.messages\", # Used in admin\n    \"django_slack_tools.slack_messages\",\n    ...\n]\n</code></pre> <p>Add configuration for application:</p> <pre><code>DJANGO_SLACK_TOOLS = {\n    \"messengers\": {\n        \"default\": {\n            \"class\": \"django_slack_tools.messenger.shortcuts.Messenger\",\n            \"kwargs\": {\n                \"template_loaders\": [\n                    \"django_slack_tools.slack_messages.messenger.DjangoTemplateLoader\",\n                ],\n                \"middlewares\": [],\n                \"messaging_backend\": {\n                    \"class\": \"django_slack_tools.messenger.shortcuts.SlackBackend\",\n                    \"kwargs\": {\n                        \"slack_app\": \"&lt;module.path.to.your-slack-app&gt;\",\n                    },\n                },\n            },\n        },\n    }\n}\n</code></pre> <p>Then, run the database migration and create <code>greet.xml</code> file in <code>templates/</code> directory:</p> <pre><code>&lt;root&gt;\n    &lt;block type=\"section\"&gt;\n        &lt;text type=\"mrkdwn\"&gt;\n            {{ greet }}\n        &lt;/text&gt;\n    &lt;/block&gt;\n&lt;/root&gt;\n</code></pre> <p>Send a message:</p> <pre><code>from django_slack_tools.slack_messages.shortcuts import slack_message\n\nmessage = slack_message(\n    \"&lt;channel-id&gt;\",\n    template=\"greet.xml\",\n    context={\"greet\": \"Hello, World!\"},\n)\n</code></pre> <p>Please check the examples for more about details.</p>"},{"location":"api-references/messenger/","title":"Messenger","text":""},{"location":"api-references/messenger/#django_slack_tools.messenger.backends","title":"<code>django_slack_tools.messenger.backends</code>","text":""},{"location":"api-references/messenger/#django_slack_tools.messenger.backends.BaseBackend","title":"<code>BaseBackend</code>","text":"<p>               Bases: <code>ABC</code></p> <p>Abstract base class for messaging backends.</p> Source code in <code>django_slack_tools/messenger/backends/base.py</code> <pre><code>class BaseBackend(ABC):\n    \"\"\"Abstract base class for messaging backends.\"\"\"\n\n    def deliver(self, request: MessageRequest) -&gt; MessageResponse:\n        \"\"\"Deliver message request.\"\"\"\n        if request.body is None:\n            msg = \"Message body is required.\"\n            raise ValueError(msg)\n\n        try:\n            response = self._send_message(\n                channel=request.channel,\n                header=request.header,\n                body=request.body,\n            )\n            error = None\n        except SlackApiError as err:\n            response = err.response\n            error = traceback.format_exc()\n\n        ok = cast(\"bool\", response.get(\"ok\"))\n        data: Any\n        if ok:\n            ts = cast(\"Optional[str]\", response.get(\"ts\", None))\n            data = response.get(\"message\", {})\n            parent_ts = data.get(\"thread_ts\", None)\n        else:\n            ts = None\n            data = response.data\n            parent_ts = None\n\n        return MessageResponse(\n            request=request,\n            ok=ok,\n            error=error,\n            data=data,\n            ts=ts,\n            parent_ts=parent_ts,\n        )\n\n    @abstractmethod\n    def _send_message(self, *, channel: str, header: MessageHeader, body: MessageBody) -&gt; SlackResponse:\n        \"\"\"Internal implementation of actual 'send message' behavior.\"\"\"\n</code></pre>"},{"location":"api-references/messenger/#django_slack_tools.messenger.backends.BaseBackend.deliver","title":"<code>deliver(request)</code>","text":"<p>Deliver message request.</p> Source code in <code>django_slack_tools/messenger/backends/base.py</code> <pre><code>def deliver(self, request: MessageRequest) -&gt; MessageResponse:\n    \"\"\"Deliver message request.\"\"\"\n    if request.body is None:\n        msg = \"Message body is required.\"\n        raise ValueError(msg)\n\n    try:\n        response = self._send_message(\n            channel=request.channel,\n            header=request.header,\n            body=request.body,\n        )\n        error = None\n    except SlackApiError as err:\n        response = err.response\n        error = traceback.format_exc()\n\n    ok = cast(\"bool\", response.get(\"ok\"))\n    data: Any\n    if ok:\n        ts = cast(\"Optional[str]\", response.get(\"ts\", None))\n        data = response.get(\"message\", {})\n        parent_ts = data.get(\"thread_ts\", None)\n    else:\n        ts = None\n        data = response.data\n        parent_ts = None\n\n    return MessageResponse(\n        request=request,\n        ok=ok,\n        error=error,\n        data=data,\n        ts=ts,\n        parent_ts=parent_ts,\n    )\n</code></pre>"},{"location":"api-references/messenger/#django_slack_tools.messenger.backends.DummyBackend","title":"<code>DummyBackend</code>","text":"<p>               Bases: <code>BaseBackend</code></p> <p>An dummy backend that does nothing with message.</p> Source code in <code>django_slack_tools/messenger/backends/dummy.py</code> <pre><code>class DummyBackend(BaseBackend):\n    \"\"\"An dummy backend that does nothing with message.\"\"\"\n\n    def _send_message(self, *args: Any, **kwargs: Any) -&gt; SlackResponse:  # noqa: ARG002\n        return SlackResponse(\n            client=None,\n            http_verb=\"POST\",\n            api_url=\"https://www.slack.com/api/chat.postMessage\",\n            req_args={},\n            data={\"ok\": True},\n            headers={},\n            status_code=200,\n        )\n</code></pre>"},{"location":"api-references/messenger/#django_slack_tools.messenger.backends.LoggingBackend","title":"<code>LoggingBackend</code>","text":"<p>               Bases: <code>DummyBackend</code></p> <p>Backend that log the message rather than sending it.</p> Source code in <code>django_slack_tools/messenger/backends/logging_.py</code> <pre><code>class LoggingBackend(DummyBackend):\n    \"\"\"Backend that log the message rather than sending it.\"\"\"\n\n    def _send_message(self, *args: Any, **kwargs: Any) -&gt; SlackResponse:\n        logger.debug(\"Sending an message with following args=%r, kwargs=%r\", args, kwargs)\n        return super()._send_message(*args, **kwargs)\n</code></pre>"},{"location":"api-references/messenger/#django_slack_tools.messenger.backends.SlackBackend","title":"<code>SlackBackend</code>","text":"<p>               Bases: <code>BaseBackend</code></p> <p>Backend actually sending the messages.</p> Source code in <code>django_slack_tools/messenger/backends/slack.py</code> <pre><code>class SlackBackend(BaseBackend):\n    \"\"\"Backend actually sending the messages.\"\"\"\n\n    def __init__(self, *, slack_app: App | str) -&gt; None:\n        \"\"\"Initialize backend.\n\n        Args:\n            slack_app: Slack app instance or import string.\n        \"\"\"\n        if isinstance(slack_app, str):\n            slack_app = import_string(slack_app)\n\n        if not isinstance(slack_app, App):\n            msg = f\"Expected {App!s} instance, got {type(slack_app)}\"\n            raise TypeError(msg)\n\n        self._slack_app = slack_app\n\n    def _send_message(self, *, channel: str, header: MessageHeader, body: MessageBody) -&gt; SlackResponse:\n        return self._slack_app.client.chat_postMessage(\n            channel=channel,\n            **header.model_dump(),\n            **body.model_dump(),\n        )\n</code></pre>"},{"location":"api-references/messenger/#django_slack_tools.messenger.backends.SlackBackend.__init__","title":"<code>__init__(*, slack_app)</code>","text":"<p>Initialize backend.</p> <p>Parameters:</p> Name Type Description Default <code>slack_app</code> <code>App | str</code> <p>Slack app instance or import string.</p> required Source code in <code>django_slack_tools/messenger/backends/slack.py</code> <pre><code>def __init__(self, *, slack_app: App | str) -&gt; None:\n    \"\"\"Initialize backend.\n\n    Args:\n        slack_app: Slack app instance or import string.\n    \"\"\"\n    if isinstance(slack_app, str):\n        slack_app = import_string(slack_app)\n\n    if not isinstance(slack_app, App):\n        msg = f\"Expected {App!s} instance, got {type(slack_app)}\"\n        raise TypeError(msg)\n\n    self._slack_app = slack_app\n</code></pre>"},{"location":"api-references/messenger/#django_slack_tools.messenger.backends.SlackRedirectBackend","title":"<code>SlackRedirectBackend</code>","text":"<p>               Bases: <code>SlackBackend</code></p> <p>Inherited Slack backend with redirection to specific channels.</p> Source code in <code>django_slack_tools/messenger/backends/slack.py</code> <pre><code>class SlackRedirectBackend(SlackBackend):\n    \"\"\"Inherited Slack backend with redirection to specific channels.\"\"\"\n\n    def __init__(self, *, slack_app: App | str, redirect_channel: str, inform_redirect: bool = True) -&gt; None:\n        \"\"\"Initialize backend.\n\n        Args:\n            slack_app: Slack app instance or import string.\n            redirect_channel: Slack channel to redirect.\n            inform_redirect: Whether to append an attachment informing that the message has been redirected.\n                Defaults to `True`.\n        \"\"\"\n        self.redirect_channel = redirect_channel\n        self.inform_redirect = inform_redirect\n\n        super().__init__(slack_app=slack_app)\n\n    def _send_message(self, *, channel: str, header: MessageHeader, body: MessageBody) -&gt; SlackResponse:\n        if self.inform_redirect:\n            attachments = body.attachments or []\n            attachments.append(\n                self._make_inform_attachment(original_channel=channel),\n            )\n            body.attachments = attachments\n\n        return self._slack_app.client.chat_postMessage(\n            channel=self.redirect_channel,\n            **header.model_dump(),\n            **body.model_dump(),\n        )\n\n    def _make_inform_attachment(self, *, original_channel: str) -&gt; dict[str, Any]:\n        msg_redirect_inform = _(\n            \":warning:  This message was originally sent to channel *{channel}* but redirected here.\",\n        )\n\n        return {\n            \"color\": \"#eb4034\",\n            \"text\": msg_redirect_inform.format(channel=original_channel),\n        }\n</code></pre>"},{"location":"api-references/messenger/#django_slack_tools.messenger.backends.SlackRedirectBackend.__init__","title":"<code>__init__(*, slack_app, redirect_channel, inform_redirect=True)</code>","text":"<p>Initialize backend.</p> <p>Parameters:</p> Name Type Description Default <code>slack_app</code> <code>App | str</code> <p>Slack app instance or import string.</p> required <code>redirect_channel</code> <code>str</code> <p>Slack channel to redirect.</p> required <code>inform_redirect</code> <code>bool</code> <p>Whether to append an attachment informing that the message has been redirected. Defaults to <code>True</code>.</p> <code>True</code> Source code in <code>django_slack_tools/messenger/backends/slack.py</code> <pre><code>def __init__(self, *, slack_app: App | str, redirect_channel: str, inform_redirect: bool = True) -&gt; None:\n    \"\"\"Initialize backend.\n\n    Args:\n        slack_app: Slack app instance or import string.\n        redirect_channel: Slack channel to redirect.\n        inform_redirect: Whether to append an attachment informing that the message has been redirected.\n            Defaults to `True`.\n    \"\"\"\n    self.redirect_channel = redirect_channel\n    self.inform_redirect = inform_redirect\n\n    super().__init__(slack_app=slack_app)\n</code></pre>"},{"location":"api-references/messenger/#django_slack_tools.messenger.message_templates","title":"<code>django_slack_tools.messenger.message_templates</code>","text":""},{"location":"api-references/messenger/#django_slack_tools.messenger.message_templates.BaseTemplate","title":"<code>BaseTemplate</code>","text":"<p>               Bases: <code>ABC</code>, <code>Generic[_T]</code></p> <p>Base class for templates.</p> Source code in <code>django_slack_tools/messenger/message_templates/base.py</code> <pre><code>class BaseTemplate(ABC, Generic[_T]):\n    \"\"\"Base class for templates.\"\"\"\n\n    template: _T\n\n    @abstractmethod\n    def render(self, context: dict[str, Any]) -&gt; Any:\n        \"\"\"Render the template with the given context.\"\"\"\n</code></pre>"},{"location":"api-references/messenger/#django_slack_tools.messenger.message_templates.BaseTemplate.render","title":"<code>render(context)</code>  <code>abstractmethod</code>","text":"<p>Render the template with the given context.</p> Source code in <code>django_slack_tools/messenger/message_templates/base.py</code> <pre><code>@abstractmethod\ndef render(self, context: dict[str, Any]) -&gt; Any:\n    \"\"\"Render the template with the given context.\"\"\"\n</code></pre>"},{"location":"api-references/messenger/#django_slack_tools.messenger.message_templates.PythonTemplate","title":"<code>PythonTemplate</code>","text":"<p>               Bases: <code>BaseTemplate[_PyObj]</code></p> <p>Template that renders a dictionary.</p> Source code in <code>django_slack_tools/messenger/message_templates/python.py</code> <pre><code>class PythonTemplate(BaseTemplate[_PyObj]):\n    \"\"\"Template that renders a dictionary.\"\"\"\n\n    def __init__(self, template: _PyObj) -&gt; None:\n        \"\"\"Initialize the template.\"\"\"\n        self.template = template\n\n    def render(self, context: dict[str, Any]) -&gt; _PyObj:  # noqa: D102\n        logger.debug(\"Rendering template %r with context %r\", self.template, context)\n        result = _format_obj(self.template, context=context)\n        logger.debug(\"Rendered template %r to %r\", self.template, result)\n        return result\n</code></pre>"},{"location":"api-references/messenger/#django_slack_tools.messenger.message_templates.PythonTemplate.__init__","title":"<code>__init__(template)</code>","text":"<p>Initialize the template.</p> Source code in <code>django_slack_tools/messenger/message_templates/python.py</code> <pre><code>def __init__(self, template: _PyObj) -&gt; None:\n    \"\"\"Initialize the template.\"\"\"\n    self.template = template\n</code></pre>"},{"location":"api-references/messenger/#django_slack_tools.messenger.middlewares","title":"<code>django_slack_tools.messenger.middlewares</code>","text":""},{"location":"api-references/messenger/#django_slack_tools.messenger.middlewares.BaseMiddleware","title":"<code>BaseMiddleware</code>","text":"<p>Base class for middleware components.</p> Source code in <code>django_slack_tools/messenger/middlewares/base.py</code> <pre><code>class BaseMiddleware:\n    \"\"\"Base class for middleware components.\"\"\"\n\n    def process_request(self, request: MessageRequest) -&gt; MessageRequest | None:  # pragma: no cover\n        \"\"\"Process the incoming requests.\n\n        Args:\n            request: Message request.\n\n        Returns:\n            MessageRequest objects or `None`.\n        \"\"\"\n        return request\n\n    def process_response(self, response: MessageResponse) -&gt; MessageResponse | None:  # pragma: no cover\n        \"\"\"Processes a sequence of MessageResponse objects and returns the processed sequence.\n\n        Args:\n            response: Message response.\n\n        Returns:\n            MessageResponse objects or `None`.\n        \"\"\"\n        return response\n</code></pre>"},{"location":"api-references/messenger/#django_slack_tools.messenger.middlewares.BaseMiddleware.process_request","title":"<code>process_request(request)</code>","text":"<p>Process the incoming requests.</p> <p>Parameters:</p> Name Type Description Default <code>request</code> <code>MessageRequest</code> <p>Message request.</p> required <p>Returns:</p> Type Description <code>MessageRequest | None</code> <p>MessageRequest objects or <code>None</code>.</p> Source code in <code>django_slack_tools/messenger/middlewares/base.py</code> <pre><code>def process_request(self, request: MessageRequest) -&gt; MessageRequest | None:  # pragma: no cover\n    \"\"\"Process the incoming requests.\n\n    Args:\n        request: Message request.\n\n    Returns:\n        MessageRequest objects or `None`.\n    \"\"\"\n    return request\n</code></pre>"},{"location":"api-references/messenger/#django_slack_tools.messenger.middlewares.BaseMiddleware.process_response","title":"<code>process_response(response)</code>","text":"<p>Processes a sequence of MessageResponse objects and returns the processed sequence.</p> <p>Parameters:</p> Name Type Description Default <code>response</code> <code>MessageResponse</code> <p>Message response.</p> required <p>Returns:</p> Type Description <code>MessageResponse | None</code> <p>MessageResponse objects or <code>None</code>.</p> Source code in <code>django_slack_tools/messenger/middlewares/base.py</code> <pre><code>def process_response(self, response: MessageResponse) -&gt; MessageResponse | None:  # pragma: no cover\n    \"\"\"Processes a sequence of MessageResponse objects and returns the processed sequence.\n\n    Args:\n        response: Message response.\n\n    Returns:\n        MessageResponse objects or `None`.\n    \"\"\"\n    return response\n</code></pre>"},{"location":"api-references/messenger/#django_slack_tools.messenger.template_loaders","title":"<code>django_slack_tools.messenger.template_loaders</code>","text":""},{"location":"api-references/messenger/#django_slack_tools.messenger.template_loaders.BaseTemplateLoader","title":"<code>BaseTemplateLoader</code>","text":"<p>               Bases: <code>ABC</code></p> <p>Base class for template loaders.</p> Source code in <code>django_slack_tools/messenger/template_loaders/base.py</code> <pre><code>class BaseTemplateLoader(ABC):\n    \"\"\"Base class for template loaders.\"\"\"\n\n    @abstractmethod\n    def load(self, key: str) -&gt; BaseTemplate | None:\n        \"\"\"Load a template by key.\"\"\"\n</code></pre>"},{"location":"api-references/messenger/#django_slack_tools.messenger.template_loaders.BaseTemplateLoader.load","title":"<code>load(key)</code>  <code>abstractmethod</code>","text":"<p>Load a template by key.</p> Source code in <code>django_slack_tools/messenger/template_loaders/base.py</code> <pre><code>@abstractmethod\ndef load(self, key: str) -&gt; BaseTemplate | None:\n    \"\"\"Load a template by key.\"\"\"\n</code></pre>"},{"location":"api-references/messenger/#django_slack_tools.messenger.template_loaders.TemplateLoadError","title":"<code>TemplateLoadError</code>","text":"<p>               Bases: <code>Exception</code></p> <p>Base class for template loader errors.</p> Source code in <code>django_slack_tools/messenger/template_loaders/errors.py</code> <pre><code>class TemplateLoadError(Exception):\n    \"\"\"Base class for template loader errors.\"\"\"\n</code></pre>"},{"location":"api-references/messenger/#django_slack_tools.messenger.template_loaders.TemplateNotFoundError","title":"<code>TemplateNotFoundError</code>","text":"<p>               Bases: <code>TemplateLoadError</code></p> <p>Template not found error.</p> Source code in <code>django_slack_tools/messenger/template_loaders/errors.py</code> <pre><code>class TemplateNotFoundError(TemplateLoadError):\n    \"\"\"Template not found error.\"\"\"\n</code></pre>"},{"location":"api-references/messenger/#django_slack_tools.messenger.messenger","title":"<code>django_slack_tools.messenger.messenger</code>","text":""},{"location":"api-references/messenger/#django_slack_tools.messenger.messenger.Messenger","title":"<code>Messenger</code>","text":"<p>Messenger class that sends message using templates and middlewares.</p> <p>Components evaluated in order:</p> <ol> <li>Request processing middlewares</li> <li>Load template by key and render message in-place</li> <li>Send message</li> <li>Response processing middlewares (in reverse order)</li> </ol> Source code in <code>django_slack_tools/messenger/messenger.py</code> <pre><code>class Messenger:\n    \"\"\"Messenger class that sends message using templates and middlewares.\n\n    Components evaluated in order:\n\n    1. Request processing middlewares\n    2. Load template by key and render message in-place\n    4. Send message\n    5. Response processing middlewares (in reverse order)\n    \"\"\"\n\n    def __init__(\n        self,\n        *,\n        template_loaders: Sequence[BaseTemplateLoader],\n        middlewares: Sequence[BaseMiddleware],\n        messaging_backend: BaseBackend,\n    ) -&gt; None:\n        \"\"\"Initialize the Messenger.\n\n        Args:\n            template_loaders: A sequence of template loaders.\n                It is tried in order to load the template and the first one that returns a template is used.\n            middlewares: A sequence of middlewares.\n                Middlewares are applied in the order they are provided for request, and in reverse order for response.\n            messaging_backend: The messaging backend to be used.\n        \"\"\"\n        # Validate the template loaders\n        for tl in template_loaders:\n            if not isinstance(tl, BaseTemplateLoader):\n                msg = f\"Expected inherited from {BaseTemplateLoader!s}, got {type(tl)}\"\n                raise TypeError(msg)\n\n        self.template_loaders = template_loaders\n\n        # Validate the middlewares\n        for mw in middlewares:\n            if not isinstance(mw, BaseMiddleware):\n                msg = f\"Expected inherited from {BaseMiddleware!s}, got {type(mw)}\"\n                raise TypeError(msg)\n\n        self.middlewares = middlewares\n\n        # Validate the messaging backend\n        if not isinstance(messaging_backend, BaseBackend):\n            msg = f\"Expected inherited from {BaseBackend!s}, got {type(messaging_backend)}\"\n            raise TypeError(msg)\n\n        self.messaging_backend = messaging_backend\n\n    def send(\n        self,\n        to: str,\n        *,\n        template: str | None = None,\n        context: dict[str, str],\n        header: MessageHeader | dict[str, Any] | None = None,\n    ) -&gt; MessageResponse | None:\n        \"\"\"Simplified shortcut for `.send_request()`.\"\"\"\n        header = MessageHeader.model_validate(header or {})\n        request = MessageRequest(template_key=template, channel=to, context=context, header=header)\n        return self.send_request(request=request)\n\n    def send_request(self, request: MessageRequest) -&gt; MessageResponse | None:\n        \"\"\"Sends a message request and processes the response.\"\"\"\n        logger.info(\"Sending request: %s\", request)\n        _request = self._process_request(request)\n        if _request is None:\n            return None\n\n        self._render_message(_request)\n        response = self._deliver_message(_request)\n        _response = self._process_response(response)\n        if _response is None:\n            return None\n\n        logger.info(\"Response: %s\", _response)\n        return response\n\n    def _process_request(self, request: MessageRequest) -&gt; MessageRequest | None:\n        \"\"\"Processes the request with middlewares in forward order.\"\"\"\n        for middleware in self.middlewares:\n            logger.debug(\"Processing request (%s) with middleware %s\", request, middleware)\n            new_request = middleware.process_request(request)\n            if new_request is None:\n                logger.warning(\"Middleware %s returned `None`, skipping remaining middlewares\", middleware)\n                return None\n\n            request = new_request\n\n        logger.debug(\"Request after processing: %s\", request)\n        return request\n\n    def _render_message(self, request: MessageRequest) -&gt; None:\n        \"\"\"Updates the request with rendered message, in-place.\"\"\"\n        if request.body is not None:\n            logger.debug(\"Request already has a body, skipping rendering\")\n            return\n\n        if request.template_key is None:\n            msg = \"Template key is required to render the message\"\n            raise ValueError(msg)\n\n        template = self._get_template(request.template_key)\n        logger.debug(\"Rendering request %s with template: %s\", request, template)\n        rendered = template.render(request.context)\n        request.body = MessageBody.model_validate(rendered)\n\n    def _get_template(self, key: str) -&gt; BaseTemplate:\n        \"\"\"Loads the template by key.\"\"\"\n        for loader in self.template_loaders:\n            template = loader.load(key)\n            if template is not None:\n                return template\n\n        msg = f\"Template with key '{key}' not found\"\n        raise TemplateNotFoundError(msg)\n\n    def _deliver_message(self, request: MessageRequest) -&gt; MessageResponse:\n        \"\"\"Invoke the messaging backend to deliver the message.\"\"\"\n        logger.debug(\"Delivering message request: %s\", request)\n        response = self.messaging_backend.deliver(request)\n        logger.debug(\"Response after delivery: %s\", response)\n        return response\n\n    def _process_response(self, response: MessageResponse) -&gt; MessageResponse | None:\n        \"\"\"Processes the response with middlewares in reverse order.\"\"\"\n        for middleware in reversed(self.middlewares):\n            logger.debug(\"Processing response (%s) with middleware: %s\", response, middleware)\n            new_response = middleware.process_response(response)\n            if new_response is None:\n                logger.warning(\"Middleware %s returned `None`, skipping remaining middlewares\", middleware)\n                return None\n\n            response = new_response\n\n        logger.debug(\"Response after processing: %s\", response)\n        return response\n</code></pre>"},{"location":"api-references/messenger/#django_slack_tools.messenger.messenger.Messenger.__init__","title":"<code>__init__(*, template_loaders, middlewares, messaging_backend)</code>","text":"<p>Initialize the Messenger.</p> <p>Parameters:</p> Name Type Description Default <code>template_loaders</code> <code>Sequence[BaseTemplateLoader]</code> <p>A sequence of template loaders. It is tried in order to load the template and the first one that returns a template is used.</p> required <code>middlewares</code> <code>Sequence[BaseMiddleware]</code> <p>A sequence of middlewares. Middlewares are applied in the order they are provided for request, and in reverse order for response.</p> required <code>messaging_backend</code> <code>BaseBackend</code> <p>The messaging backend to be used.</p> required Source code in <code>django_slack_tools/messenger/messenger.py</code> <pre><code>def __init__(\n    self,\n    *,\n    template_loaders: Sequence[BaseTemplateLoader],\n    middlewares: Sequence[BaseMiddleware],\n    messaging_backend: BaseBackend,\n) -&gt; None:\n    \"\"\"Initialize the Messenger.\n\n    Args:\n        template_loaders: A sequence of template loaders.\n            It is tried in order to load the template and the first one that returns a template is used.\n        middlewares: A sequence of middlewares.\n            Middlewares are applied in the order they are provided for request, and in reverse order for response.\n        messaging_backend: The messaging backend to be used.\n    \"\"\"\n    # Validate the template loaders\n    for tl in template_loaders:\n        if not isinstance(tl, BaseTemplateLoader):\n            msg = f\"Expected inherited from {BaseTemplateLoader!s}, got {type(tl)}\"\n            raise TypeError(msg)\n\n    self.template_loaders = template_loaders\n\n    # Validate the middlewares\n    for mw in middlewares:\n        if not isinstance(mw, BaseMiddleware):\n            msg = f\"Expected inherited from {BaseMiddleware!s}, got {type(mw)}\"\n            raise TypeError(msg)\n\n    self.middlewares = middlewares\n\n    # Validate the messaging backend\n    if not isinstance(messaging_backend, BaseBackend):\n        msg = f\"Expected inherited from {BaseBackend!s}, got {type(messaging_backend)}\"\n        raise TypeError(msg)\n\n    self.messaging_backend = messaging_backend\n</code></pre>"},{"location":"api-references/messenger/#django_slack_tools.messenger.messenger.Messenger.send","title":"<code>send(to, *, template=None, context, header=None)</code>","text":"<p>Simplified shortcut for <code>.send_request()</code>.</p> Source code in <code>django_slack_tools/messenger/messenger.py</code> <pre><code>def send(\n    self,\n    to: str,\n    *,\n    template: str | None = None,\n    context: dict[str, str],\n    header: MessageHeader | dict[str, Any] | None = None,\n) -&gt; MessageResponse | None:\n    \"\"\"Simplified shortcut for `.send_request()`.\"\"\"\n    header = MessageHeader.model_validate(header or {})\n    request = MessageRequest(template_key=template, channel=to, context=context, header=header)\n    return self.send_request(request=request)\n</code></pre>"},{"location":"api-references/messenger/#django_slack_tools.messenger.messenger.Messenger.send_request","title":"<code>send_request(request)</code>","text":"<p>Sends a message request and processes the response.</p> Source code in <code>django_slack_tools/messenger/messenger.py</code> <pre><code>def send_request(self, request: MessageRequest) -&gt; MessageResponse | None:\n    \"\"\"Sends a message request and processes the response.\"\"\"\n    logger.info(\"Sending request: %s\", request)\n    _request = self._process_request(request)\n    if _request is None:\n        return None\n\n    self._render_message(_request)\n    response = self._deliver_message(_request)\n    _response = self._process_response(response)\n    if _response is None:\n        return None\n\n    logger.info(\"Response: %s\", _response)\n    return response\n</code></pre>"},{"location":"api-references/messenger/#django_slack_tools.messenger.request","title":"<code>django_slack_tools.messenger.request</code>","text":""},{"location":"api-references/messenger/#django_slack_tools.messenger.request.MessageBody","title":"<code>MessageBody</code>","text":"<p>               Bases: <code>BaseModel</code></p> Source code in <code>django_slack_tools/messenger/request.py</code> <pre><code>class MessageBody(BaseModel):  # noqa: D101\n    model_config = ConfigDict(extra=\"forbid\")\n\n    attachments: Optional[List[dict]] = None\n\n    # See more about blocks at https://api.slack.com/reference/block-kit/blocks\n    blocks: Optional[list[dict]] = None\n\n    text: Optional[str] = None\n    icon_emoji: Optional[str] = None\n    icon_url: Optional[str] = None\n    metadata: Optional[dict] = None\n    username: Optional[str] = None\n\n    @model_validator(mode=\"after\")\n    def _check_at_least_one_field_is_set(self) -&gt; MessageBody:\n        if not any((self.attachments, self.blocks, self.text)):\n            msg = \"At least one of `attachments`, `blocks` and `text` must set\"\n            raise ValueError(msg)\n\n        return self\n\n    @classmethod\n    def from_any(cls, obj: str | MessageBody | dict[str, Any]) -&gt; MessageBody:\n        \"\"\"Create instance from compatible types.\"\"\"\n        if isinstance(obj, cls):\n            return obj\n\n        if isinstance(obj, dict):\n            return cls.model_validate(obj)\n\n        if isinstance(obj, str):\n            return cls(text=obj)\n\n        msg = f\"Unsupported type {type(obj)}\"\n        raise TypeError(msg)\n</code></pre>"},{"location":"api-references/messenger/#django_slack_tools.messenger.request.MessageBody.from_any","title":"<code>from_any(obj)</code>  <code>classmethod</code>","text":"<p>Create instance from compatible types.</p> Source code in <code>django_slack_tools/messenger/request.py</code> <pre><code>@classmethod\ndef from_any(cls, obj: str | MessageBody | dict[str, Any]) -&gt; MessageBody:\n    \"\"\"Create instance from compatible types.\"\"\"\n    if isinstance(obj, cls):\n        return obj\n\n    if isinstance(obj, dict):\n        return cls.model_validate(obj)\n\n    if isinstance(obj, str):\n        return cls(text=obj)\n\n    msg = f\"Unsupported type {type(obj)}\"\n    raise TypeError(msg)\n</code></pre>"},{"location":"api-references/messenger/#django_slack_tools.messenger.request.MessageHeader","title":"<code>MessageHeader</code>","text":"<p>               Bases: <code>BaseModel</code></p> Source code in <code>django_slack_tools/messenger/request.py</code> <pre><code>class MessageHeader(BaseModel):  # noqa: D101\n    model_config = ConfigDict(extra=\"forbid\")\n\n    mrkdwn: Optional[str] = None\n    parse: Optional[str] = None\n    reply_broadcast: Optional[bool] = None\n    thread_ts: Optional[str] = None\n    unfurl_links: Optional[bool] = None\n    unfurl_media: Optional[bool] = None\n\n    @classmethod\n    def from_any(cls, obj: MessageHeader | dict[str, Any] | None = None) -&gt; MessageHeader:\n        \"\"\"Create instance from compatible types.\"\"\"\n        if isinstance(obj, cls):\n            return obj\n\n        if isinstance(obj, dict):\n            return cls.model_validate(obj)\n\n        if obj is None:\n            return cls()\n\n        msg = f\"Unsupported type {type(obj)}\"\n        raise TypeError(msg)\n</code></pre>"},{"location":"api-references/messenger/#django_slack_tools.messenger.request.MessageHeader.from_any","title":"<code>from_any(obj=None)</code>  <code>classmethod</code>","text":"<p>Create instance from compatible types.</p> Source code in <code>django_slack_tools/messenger/request.py</code> <pre><code>@classmethod\ndef from_any(cls, obj: MessageHeader | dict[str, Any] | None = None) -&gt; MessageHeader:\n    \"\"\"Create instance from compatible types.\"\"\"\n    if isinstance(obj, cls):\n        return obj\n\n    if isinstance(obj, dict):\n        return cls.model_validate(obj)\n\n    if obj is None:\n        return cls()\n\n    msg = f\"Unsupported type {type(obj)}\"\n    raise TypeError(msg)\n</code></pre>"},{"location":"api-references/messenger/#django_slack_tools.messenger.request.MessageRequest","title":"<code>MessageRequest</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Message request object.</p> Source code in <code>django_slack_tools/messenger/request.py</code> <pre><code>class MessageRequest(BaseModel):\n    \"\"\"Message request object.\"\"\"\n\n    model_config = ConfigDict(extra=\"forbid\")\n\n    id_: str = Field(default_factory=lambda: str(uuid.uuid4()))\n    channel: Any\n\n    # Template key is optional to allow lazy initialization of the template key\n    template_key: Optional[str]\n\n    context: Dict[str, Any]\n    header: MessageHeader\n\n    # Also, the body is optional because it is rendered from the template\n    body: Optional[MessageBody] = None\n</code></pre>"},{"location":"api-references/messenger/#django_slack_tools.messenger.response","title":"<code>django_slack_tools.messenger.response</code>","text":""},{"location":"api-references/messenger/#django_slack_tools.messenger.response.MessageResponse","title":"<code>MessageResponse</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Response from a messaging backend.</p> Source code in <code>django_slack_tools/messenger/response.py</code> <pre><code>class MessageResponse(BaseModel):\n    \"\"\"Response from a messaging backend.\"\"\"\n\n    request: Optional[MessageRequest] = None\n    ok: bool\n    error: Optional[Any] = None\n    data: Any\n    ts: Optional[str] = None\n    parent_ts: Optional[str] = None\n</code></pre>"},{"location":"api-references/slack-messages/","title":"Slack Messages","text":""},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.messenger","title":"<code>django_slack_tools.slack_messages.messenger</code>","text":""},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.messenger.DjangoDatabasePersister","title":"<code>DjangoDatabasePersister</code>","text":"<p>               Bases: <code>BaseMiddleware</code></p> <p>Persist message history to database. If request is <code>None</code>, will do nothing.</p> Source code in <code>django_slack_tools/slack_messages/messenger/middlewares.py</code> <pre><code>class DjangoDatabasePersister(BaseMiddleware):\n    \"\"\"Persist message history to database. If request is `None`, will do nothing.\"\"\"\n\n    def __init__(self, *, slack_app: App | None = None, get_permalink: bool = False) -&gt; None:\n        \"\"\"Initialize the middleware.\n\n        Args:\n            slack_app: Slack app instance to use for certain tasks, such as getting permalinks.\n            get_permalink: If `True`, will try to get the permalink of the message.\n        \"\"\"\n        if get_permalink and not isinstance(slack_app, App):\n            msg = \"`slack_app` must be an instance of `App` if `get_permalink` is set `True`.\"\n            raise ValueError(msg)\n\n        self.slack_app = slack_app\n        self.get_permalink = get_permalink\n\n    def process_response(self, response: MessageResponse) -&gt; MessageResponse | None:  # noqa: D102\n        request = response.request\n        if request is None:\n            logger.warning(\"No request found in response, skipping persister.\")\n            return response\n\n        logger.debug(\"Getting permalink for message: %s\", response)\n        if self.get_permalink:  # noqa: SIM108\n            permalink = self._get_permalink(channel=request.channel, ts=response.ts)\n        else:\n            permalink = \"\"\n\n        logger.debug(\"Persisting message history to database: %s\", response)\n        try:\n            history = SlackMessage(\n                id=request.id_,\n                channel=request.channel,\n                header=request.header.model_dump(),\n                body=request.body.model_dump() if request.body else {},\n                ok=response.ok,\n                permalink=permalink,\n                ts=response.ts,\n                parent_ts=response.parent_ts or \"\",\n                request=request.model_dump(),\n                response=response.model_dump(exclude={\"request\"}),\n                exception=response.error or \"\",\n            )\n            history.save()\n        except Exception:\n            logger.exception(\"Error while saving message history: %s\", response)\n\n        return response\n\n    def _get_permalink(self, *, channel: str, ts: str | None) -&gt; str:\n        \"\"\"Get permalink of the message. It returns empty string on error.\"\"\"\n        if not self.slack_app:\n            logger.warning(\"Slack app not provided, cannot get permalink.\")\n            return \"\"\n\n        if not ts:\n            logger.warning(\"No message ts provided, cannot get permalink.\")\n            return \"\"\n\n        try:\n            response = self.slack_app.client.chat_getPermalink(channel=channel, message_ts=ts)\n            return response.get(\"permalink\", default=\"\")\n        except SlackApiError as err:\n            logger.debug(\"Error while getting permalink: %s\", exc_info=err)\n            return \"\"\n</code></pre>"},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.messenger.DjangoDatabasePersister.__init__","title":"<code>__init__(*, slack_app=None, get_permalink=False)</code>","text":"<p>Initialize the middleware.</p> <p>Parameters:</p> Name Type Description Default <code>slack_app</code> <code>App | None</code> <p>Slack app instance to use for certain tasks, such as getting permalinks.</p> <code>None</code> <code>get_permalink</code> <code>bool</code> <p>If <code>True</code>, will try to get the permalink of the message.</p> <code>False</code> Source code in <code>django_slack_tools/slack_messages/messenger/middlewares.py</code> <pre><code>def __init__(self, *, slack_app: App | None = None, get_permalink: bool = False) -&gt; None:\n    \"\"\"Initialize the middleware.\n\n    Args:\n        slack_app: Slack app instance to use for certain tasks, such as getting permalinks.\n        get_permalink: If `True`, will try to get the permalink of the message.\n    \"\"\"\n    if get_permalink and not isinstance(slack_app, App):\n        msg = \"`slack_app` must be an instance of `App` if `get_permalink` is set `True`.\"\n        raise ValueError(msg)\n\n    self.slack_app = slack_app\n    self.get_permalink = get_permalink\n</code></pre>"},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.messenger.DjangoDatabasePolicyHandler","title":"<code>DjangoDatabasePolicyHandler</code>","text":"<p>               Bases: <code>BaseMiddleware</code></p> <p>Middleware to handle Slack messaging policies stored in the database.</p> <p>Be cautious when using this middleware because it includes functionality to distribute messages to multiple recipients, which could lead to unwanted infinite loop or recursion if used improperly.</p> <p>This middleware contains a secondary protection against infinite loops by injecting a context key to the message context. If the key is found in the context, the middleware will stop the message from being sent. So be careful when modifying the context.</p> Source code in <code>django_slack_tools/slack_messages/messenger/middlewares.py</code> <pre><code>class DjangoDatabasePolicyHandler(BaseMiddleware):\n    \"\"\"Middleware to handle Slack messaging policies stored in the database.\n\n    Be cautious when using this middleware because it includes functionality to distribute messages to multiple recipients,\n    which could lead to unwanted infinite loop or recursion if used improperly.\n\n    This middleware contains a secondary protection against infinite loops by injecting a context key to the message context.\n    If the key is found in the context, the middleware will stop the message from being sent. So be careful when modifying the context.\n    \"\"\"  # noqa: E501\n\n    _RECURSION_DETECTION_CONTEXT_KEY = \"__final__\"\n    \"\"\"Recursion detection key injected to message context for fanned-out messages to provide secondary protection against infinite loops.\"\"\"  # noqa: E501\n\n    def __init__(\n        self,\n        *,\n        messenger: Messenger | str,\n        on_policy_not_exists: OnPolicyNotExists = \"error\",\n    ) -&gt; None:\n        \"\"\"Initialize the middleware.\n\n        This middleware will load the policy from the database and send the message to all recipients.\n\n        Args:\n            messenger: Messenger instance or name to use for sending messages.\n                The messenger instance should be different from the one used in the policy handler,\n                because this middleware cannot properly handle fanned-out messages modified by this middleware.\n                Also, there are chances of infinite loops if the same messenger is used.\n            on_policy_not_exists: Action to take when policy is not found.\n        \"\"\"\n        if on_policy_not_exists not in (\"create\", \"default\", \"error\"):\n            msg = f'Unknown value for `on_policy_not_exists`: \"{on_policy_not_exists}\"'\n            raise ValueError(msg)\n\n        self._messenger = messenger\n        self.on_policy_not_exists = on_policy_not_exists\n\n    # * It's not desirable to put import in the method,\n    # * but it's the only way to avoid circular imports for now (what's the fix?)\n    @property\n    def messenger(self) -&gt; Messenger:\n        \"\"\"Get the messenger instance. If it's a string, will get the messenger from the app settings.\"\"\"\n        if isinstance(self._messenger, str):\n            from django_slack_tools.app_settings import get_messenger  # noqa: PLC0415\n\n            self._messenger = get_messenger(self._messenger)\n\n        return self._messenger\n\n    def process_request(self, request: MessageRequest) -&gt; MessageRequest | None:  # noqa: D102\n        # TODO(lasuillard): Hacky way to stop the request, need to find a better way\n        #                   Some extra field (request.meta) could be added to share control context\n        if request.context.get(self._RECURSION_DETECTION_CONTEXT_KEY, False):\n            return request\n\n        code = request.channel\n        policy = self._get_policy(code=code)\n        if not policy.enabled:\n            logger.debug(\"Policy %s is disabled, skipping further messaging\", policy)\n            return None\n\n        requests: list[MessageRequest] = []\n        for recipient in policy.recipients.all():\n            default_context = self._get_default_context(recipient)\n            context = {\n                **default_context,\n                **request.context,\n                self._RECURSION_DETECTION_CONTEXT_KEY: True,\n            }\n            header = MessageHeader.model_validate(\n                {\n                    **policy.header_defaults,\n                    **request.header.model_dump(),\n                },\n            )\n            req = MessageRequest(channel=recipient.channel, template_key=policy.code, context=context, header=header)\n            requests.append(req)\n\n        # TODO(lasuillard): How to provide users the access the newly created messages?\n        #                   currently, it's possible with persisters but it would require some additional work\n        # TODO(lasuillard): Can `sys.setrecursionlimit` be used to prevent spamming if recursion occurs?\n        for req in requests:\n            self.messenger.send_request(req)\n\n        # Stop current request\n        return None\n\n    def _get_policy(self, *, code: str) -&gt; SlackMessagingPolicy:\n        \"\"\"Get the policy for the given code.\"\"\"\n        try:\n            policy = SlackMessagingPolicy.objects.get(code=code)\n        except SlackMessagingPolicy.DoesNotExist:\n            if self.on_policy_not_exists == \"create\":\n                logger.warning(\"No policy found for template key, creating one: %s\", code)\n                policy = self._create_policy(code=code)\n            elif self.on_policy_not_exists == \"default\":\n                policy = SlackMessagingPolicy.objects.get(code=\"DEFAULT\")\n            elif self.on_policy_not_exists == \"error\":\n                raise\n            else:\n                msg = f'Unknown value for `on_policy_not_exists`: \"{self.on_policy_not_exists}\"'\n                raise ValueError(msg) from None\n\n        return policy\n\n    def _create_policy(self, *, code: str) -&gt; SlackMessagingPolicy:\n        \"\"\"Create a policy with the given code.\n\n        Policy created is disabled by default, thus no message will be sent.\n        To modify the default policy creation behavior, simply override this method.\n        \"\"\"\n        policy = SlackMessagingPolicy.objects.create(\n            code=code,\n            enabled=False,\n            template_type=SlackMessagingPolicy.TemplateType.UNKNOWN,\n        )\n        default_recipients = SlackMessageRecipient.objects.filter(alias=\"DEFAULT\")\n        policy.recipients.set(default_recipients)\n        return policy\n\n    def _get_default_context(self, recipient: SlackMessageRecipient) -&gt; dict:\n        \"\"\"Create default context for the recipient.\"\"\"\n        mentions = [mention.mention for mention in recipient.mentions.all()]\n        return {\n            \"mentions\": mentions,\n        }\n</code></pre>"},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.messenger.DjangoDatabasePolicyHandler.messenger","title":"<code>messenger</code>  <code>property</code>","text":"<p>Get the messenger instance. If it's a string, will get the messenger from the app settings.</p>"},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.messenger.DjangoDatabasePolicyHandler.__init__","title":"<code>__init__(*, messenger, on_policy_not_exists='error')</code>","text":"<p>Initialize the middleware.</p> <p>This middleware will load the policy from the database and send the message to all recipients.</p> <p>Parameters:</p> Name Type Description Default <code>messenger</code> <code>Messenger | str</code> <p>Messenger instance or name to use for sending messages. The messenger instance should be different from the one used in the policy handler, because this middleware cannot properly handle fanned-out messages modified by this middleware. Also, there are chances of infinite loops if the same messenger is used.</p> required <code>on_policy_not_exists</code> <code>OnPolicyNotExists</code> <p>Action to take when policy is not found.</p> <code>'error'</code> Source code in <code>django_slack_tools/slack_messages/messenger/middlewares.py</code> <pre><code>def __init__(\n    self,\n    *,\n    messenger: Messenger | str,\n    on_policy_not_exists: OnPolicyNotExists = \"error\",\n) -&gt; None:\n    \"\"\"Initialize the middleware.\n\n    This middleware will load the policy from the database and send the message to all recipients.\n\n    Args:\n        messenger: Messenger instance or name to use for sending messages.\n            The messenger instance should be different from the one used in the policy handler,\n            because this middleware cannot properly handle fanned-out messages modified by this middleware.\n            Also, there are chances of infinite loops if the same messenger is used.\n        on_policy_not_exists: Action to take when policy is not found.\n    \"\"\"\n    if on_policy_not_exists not in (\"create\", \"default\", \"error\"):\n        msg = f'Unknown value for `on_policy_not_exists`: \"{on_policy_not_exists}\"'\n        raise ValueError(msg)\n\n    self._messenger = messenger\n    self.on_policy_not_exists = on_policy_not_exists\n</code></pre>"},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.messenger.DjangoPolicyTemplateLoader","title":"<code>DjangoPolicyTemplateLoader</code>","text":"<p>               Bases: <code>BaseTemplateLoader</code></p> <p>Django database-backed template loader.</p> Source code in <code>django_slack_tools/slack_messages/messenger/template_loaders.py</code> <pre><code>class DjangoPolicyTemplateLoader(BaseTemplateLoader):\n    \"\"\"Django database-backed template loader.\"\"\"\n\n    def load(self, key: str) -&gt; PythonTemplate | DjangoTemplate | None:  # noqa: D102\n        return self._get_template_from_policy(policy_or_code=key)\n\n    def _get_template_from_policy(\n        self,\n        policy_or_code: SlackMessagingPolicy | str,\n    ) -&gt; PythonTemplate | DjangoTemplate | None:\n        \"\"\"Get template instance.\"\"\"\n        if isinstance(policy_or_code, str):\n            try:\n                policy = SlackMessagingPolicy.objects.get(code=policy_or_code)\n            except SlackMessagingPolicy.DoesNotExist:\n                logger.warning(\"Policy not found: %s\", policy_or_code)\n                return None\n        else:\n            policy = policy_or_code\n\n        if policy.template_type == SlackMessagingPolicy.TemplateType.PYTHON:\n            return PythonTemplate(policy.template)\n\n        if policy.template_type == SlackMessagingPolicy.TemplateType.DJANGO:\n            try:\n                return DjangoTemplate(file=policy.template)\n            except TemplateDoesNotExist:\n                logger.debug(\"Template not found: %s\", policy.template)\n                return None\n\n        if policy.template_type == SlackMessagingPolicy.TemplateType.DJANGO_INLINE:\n            return DjangoTemplate(inline=policy.template)\n\n        msg = f\"Unsupported template type: {policy.template_type!r}\"\n        raise ValueError(msg)\n</code></pre>"},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.messenger.DjangoTemplate","title":"<code>DjangoTemplate</code>","text":"<p>               Bases: <code>BaseTemplate</code></p> <p>Template utilizing Django built-in template engine.</p> Source code in <code>django_slack_tools/slack_messages/messenger/message_templates.py</code> <pre><code>class DjangoTemplate(BaseTemplate):\n    \"\"\"Template utilizing Django built-in template engine.\"\"\"\n\n    template: Template\n\n    @overload\n    def __init__(self, *, file: str, engine: BaseEngine | None = None) -&gt; None: ...  # pragma: no cover\n\n    @overload\n    def __init__(self, *, inline: str, engine: BaseEngine | None = None) -&gt; None: ...  # pragma: no cover\n\n    def __init__(\n        self,\n        *,\n        file: str | None = None,\n        inline: str | None = None,\n        engine: BaseEngine | None = None,\n    ) -&gt; None:\n        \"\"\"Initialize template.\n\n        Args:\n            file: Path to file with template.\n            inline: XML inline template.\n            engine: Template engine to use. Defaults to Django engine.\n\n        Raises:\n            TypeError: Some of the arguments are missing or multiple are provided.\n        \"\"\"\n        engine = engines[\"django\"] if engine is None else engine\n\n        if len([value for value in (file, inline) if value is not None]) != 1:\n            msg = \"Exactly one of 'file' or 'inline' must be provided.\"\n            raise TypeError(msg)\n\n        if file:\n            template = engine.get_template(file)\n        elif inline:\n            template = engine.from_string(inline)\n        else:  # pragma: no cover\n            msg = \"Unreachable code\"\n            raise NotImplementedError(msg)\n\n        self.template = template  # type: ignore[assignment] # False-positive error\n\n    def render(self, context: dict[str, Any]) -&gt; Any:  # noqa: D102\n        logger.debug(\"Rendering template with context: %r\", context)\n        rendered = self.template.render(context=context)  # type: ignore[arg-type] # False-positive error\n        return _xml_to_dict(rendered)\n</code></pre>"},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.messenger.DjangoTemplate.__init__","title":"<code>__init__(*, file=None, inline=None, engine=None)</code>","text":"<pre><code>__init__(\n    *, file: str, engine: BaseEngine | None = None\n) -&gt; None\n</code></pre><pre><code>__init__(\n    *, inline: str, engine: BaseEngine | None = None\n) -&gt; None\n</code></pre> <p>Initialize template.</p> <p>Parameters:</p> Name Type Description Default <code>file</code> <code>str | None</code> <p>Path to file with template.</p> <code>None</code> <code>inline</code> <code>str | None</code> <p>XML inline template.</p> <code>None</code> <code>engine</code> <code>BaseEngine | None</code> <p>Template engine to use. Defaults to Django engine.</p> <code>None</code> <p>Raises:</p> Type Description <code>TypeError</code> <p>Some of the arguments are missing or multiple are provided.</p> Source code in <code>django_slack_tools/slack_messages/messenger/message_templates.py</code> <pre><code>def __init__(\n    self,\n    *,\n    file: str | None = None,\n    inline: str | None = None,\n    engine: BaseEngine | None = None,\n) -&gt; None:\n    \"\"\"Initialize template.\n\n    Args:\n        file: Path to file with template.\n        inline: XML inline template.\n        engine: Template engine to use. Defaults to Django engine.\n\n    Raises:\n        TypeError: Some of the arguments are missing or multiple are provided.\n    \"\"\"\n    engine = engines[\"django\"] if engine is None else engine\n\n    if len([value for value in (file, inline) if value is not None]) != 1:\n        msg = \"Exactly one of 'file' or 'inline' must be provided.\"\n        raise TypeError(msg)\n\n    if file:\n        template = engine.get_template(file)\n    elif inline:\n        template = engine.from_string(inline)\n    else:  # pragma: no cover\n        msg = \"Unreachable code\"\n        raise NotImplementedError(msg)\n\n    self.template = template  # type: ignore[assignment] # False-positive error\n</code></pre>"},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.messenger.DjangoTemplateLoader","title":"<code>DjangoTemplateLoader</code>","text":"<p>               Bases: <code>BaseTemplateLoader</code></p> <p>Django filesystem-backed template loader.</p> Source code in <code>django_slack_tools/slack_messages/messenger/template_loaders.py</code> <pre><code>class DjangoTemplateLoader(BaseTemplateLoader):\n    \"\"\"Django filesystem-backed template loader.\"\"\"\n\n    def __init__(self, *, engine: BaseEngine | None = None) -&gt; None:\n        \"\"\"Initialize template loader.\n\n        Args:\n            engine: Template engine to use. Defaults to Django engine.\n        \"\"\"\n        self.engine = engines[\"django\"] if engine is None else engine\n\n    def load(self, key: str) -&gt; DjangoTemplate | None:  # noqa: D102\n        try:\n            return DjangoTemplate(file=key, engine=self.engine)\n        except TemplateDoesNotExist:\n            logger.debug(\"Template not found: %s\", key)\n            return None\n</code></pre>"},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.messenger.DjangoTemplateLoader.__init__","title":"<code>__init__(*, engine=None)</code>","text":"<p>Initialize template loader.</p> <p>Parameters:</p> Name Type Description Default <code>engine</code> <code>BaseEngine | None</code> <p>Template engine to use. Defaults to Django engine.</p> <code>None</code> Source code in <code>django_slack_tools/slack_messages/messenger/template_loaders.py</code> <pre><code>def __init__(self, *, engine: BaseEngine | None = None) -&gt; None:\n    \"\"\"Initialize template loader.\n\n    Args:\n        engine: Template engine to use. Defaults to Django engine.\n    \"\"\"\n    self.engine = engines[\"django\"] if engine is None else engine\n</code></pre>"},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.models","title":"<code>django_slack_tools.slack_messages.models</code>","text":""},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.models.SlackMention","title":"<code>SlackMention</code>","text":"<p>               Bases: <code>TimestampMixin</code>, <code>Model</code></p> <p>People or group in channels receive messages.</p> Source code in <code>django_slack_tools/slack_messages/models/mention.py</code> <pre><code>class SlackMention(TimestampMixin, models.Model):\n    \"\"\"People or group in channels receive messages.\"\"\"\n\n    class MentionType(models.TextChoices):\n        \"\"\"Possible mention types.\"\"\"\n\n        USER = \"U\", _(\"User\")\n        \"User mentions. e.g. `@lasuillard`.\"\n\n        GROUP = \"G\", _(\"Group\")\n        \"Team mentions. e.g. `@backend`.\"\n\n        SPECIAL = \"S\", _(\"Special\")\n        \"Special mentions. e.g. `@here`, `@channel`, `@everyone`.\"\n\n        UNKNOWN = \"?\", _(\"Unknown\")\n        \"Unknown mention type.\"\n\n    type = models.CharField(\n        verbose_name=_(\"Type\"),\n        help_text=_(\"Type of mentions.\"),\n        max_length=1,\n        choices=MentionType.choices,\n        blank=False,\n    )\n    name = models.CharField(\n        verbose_name=_(\"Name\"),\n        help_text=_(\"Human-friendly mention name.\"),\n        max_length=128,\n    )\n    mention_id = models.CharField(\n        verbose_name=_(\"Mention ID\"),\n        help_text=_(\"User or group ID, or raw mention itself.\"),\n        max_length=32,\n    )\n\n    objects: SlackMentionManager = SlackMentionManager()\n\n    class Meta:  # noqa: D106\n        verbose_name = _(\"Mention\")\n        verbose_name_plural = _(\"Mentions\")\n\n    def __str__(self) -&gt; str:\n        return _(\"{name} ({type}, {mention_id})\").format(\n            name=self.name,\n            type=self.get_type_display(),\n            mention_id=self.mention_id,\n        )\n\n    @property\n    def mention(self) -&gt; str:\n        \"\"\"Mention string for use in messages, e.g. `\"&lt;@{USER_ID}&gt;\"`.\"\"\"\n        if self.type == SlackMention.MentionType.USER:\n            return f\"&lt;@{self.mention_id}&gt;\"\n\n        if self.type == SlackMention.MentionType.GROUP:\n            return f\"&lt;!subteam^{self.mention_id}&gt;\"\n\n        return self.mention_id\n</code></pre>"},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.models.SlackMention.mention","title":"<code>mention</code>  <code>property</code>","text":"<p>Mention string for use in messages, e.g. <code>\"&lt;@{USER_ID}&gt;\"</code>.</p>"},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.models.SlackMention.MentionType","title":"<code>MentionType</code>","text":"<p>               Bases: <code>TextChoices</code></p> <p>Possible mention types.</p> Source code in <code>django_slack_tools/slack_messages/models/mention.py</code> <pre><code>class MentionType(models.TextChoices):\n    \"\"\"Possible mention types.\"\"\"\n\n    USER = \"U\", _(\"User\")\n    \"User mentions. e.g. `@lasuillard`.\"\n\n    GROUP = \"G\", _(\"Group\")\n    \"Team mentions. e.g. `@backend`.\"\n\n    SPECIAL = \"S\", _(\"Special\")\n    \"Special mentions. e.g. `@here`, `@channel`, `@everyone`.\"\n\n    UNKNOWN = \"?\", _(\"Unknown\")\n    \"Unknown mention type.\"\n</code></pre>"},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.models.SlackMention.MentionType.GROUP","title":"<code>GROUP = ('G', _('Group'))</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>Team mentions. e.g. <code>@backend</code>.</p>"},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.models.SlackMention.MentionType.SPECIAL","title":"<code>SPECIAL = ('S', _('Special'))</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>Special mentions. e.g. <code>@here</code>, <code>@channel</code>, <code>@everyone</code>.</p>"},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.models.SlackMention.MentionType.UNKNOWN","title":"<code>UNKNOWN = ('?', _('Unknown'))</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>Unknown mention type.</p>"},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.models.SlackMention.MentionType.USER","title":"<code>USER = ('U', _('User'))</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>User mentions. e.g. <code>@lasuillard</code>.</p>"},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.models.SlackMessage","title":"<code>SlackMessage</code>","text":"<p>               Bases: <code>TimestampMixin</code>, <code>Model</code></p> <p>An Slack message.</p> Source code in <code>django_slack_tools/slack_messages/models/message.py</code> <pre><code>class SlackMessage(TimestampMixin, models.Model):\n    \"\"\"An Slack message.\"\"\"\n\n    id = models.CharField(primary_key=True, unique=True, max_length=255, default=uuid.uuid4, editable=False)\n    policy = models.ForeignKey(\n        SlackMessagingPolicy,\n        verbose_name=_(\"Messaging Policy\"),\n        help_text=_(\"Messaging policy for this message.\"),\n        null=True,  # Message can be built from scratch without using templates\n        blank=True,\n        on_delete=models.SET_NULL,\n    )\n    channel = models.CharField(\n        verbose_name=_(\"Channel\"),\n        help_text=_(\"ID of channel this message sent to.\"),\n        blank=False,\n        max_length=128,  # Maximum length of channel name is 80 characters\n    )\n    header = models.JSONField(\n        verbose_name=_(\"Header\"),\n        help_text=_(\n            \"Slack control arguments.\"\n            \" Allowed fields are `mrkdwn`, `parse`, `reply_broadcast`, `thread_ts`, `unfurl_links`, `unfurl_media`.\",\n        ),\n        validators=[header_validator],\n    )\n    body = models.JSONField(\n        verbose_name=_(\"Body\"),\n        help_text=_(\n            \"Message body.\"\n            \" Allowed fields are `attachments`, `body`, `text`, `icon_emoji`, `icon_url`, `metadata`, `username`.\",\n        ),\n        validators=[body_validator],\n    )\n    ok = models.BooleanField(\n        verbose_name=_(\"OK\"),\n        help_text=_(\"Whether Slack API respond with OK. If never sent, will be `null`.\"),\n        null=True,\n        default=None,\n    )\n    permalink = models.CharField(\n        verbose_name=_(\"Permalink\"),\n        help_text=_(\"Permanent link for this message.\"),\n        max_length=256,\n        default=\"\",\n        blank=True,\n    )\n\n    # As ID, `ts` assigned by Slack, it is known after received response\n    # By known, `ts` refers to timestamp (Format of `datetime.timestamp()`, e.g. `\"1702737142.945359\"`)\n    ts = models.CharField(\n        verbose_name=_(\"Message ID\"),\n        help_text=_(\"ID of an Slack message.\"),\n        max_length=32,\n        null=True,\n        blank=True,\n        unique=True,\n    )\n    parent_ts = models.CharField(\n        verbose_name=_(\"Thread ID\"),\n        help_text=_(\"ID of current conversation thread.\"),\n        max_length=32,\n        default=\"\",\n        blank=True,\n    )\n\n    # Extraneous call detail for debugging\n    request = models.JSONField(\n        verbose_name=_(\"Request\"),\n        help_text=_(\"Dump of request content for debugging.\"),\n        null=True,\n        blank=True,\n    )\n    response = models.JSONField(\n        verbose_name=_(\"Response\"),\n        help_text=_(\"Dump of response content for debugging.\"),\n        null=True,\n        blank=True,\n    )\n    exception = models.TextField(\n        verbose_name=_(\"Exception\"),\n        help_text=_(\"Exception message if any.\"),\n        blank=True,\n    )\n\n    objects: SlackMessageManager = SlackMessageManager()\n\n    class Meta:  # noqa: D106\n        verbose_name = _(\"Message\")\n        verbose_name_plural = _(\"Messages\")\n        ordering = (\"-created\",)\n\n    def __str__(self) -&gt; str:\n        if self.ok is True:\n            return _(\"Message ({ts}, OK)\").format(id=self.id, ts=self.ts)\n\n        if self.ok is False:\n            return _(\"Message ({id}, not OK)\").format(id=self.id)\n\n        return _(\"Message ({id}, not sent)\").format(id=self.id)\n</code></pre>"},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.models.SlackMessageRecipient","title":"<code>SlackMessageRecipient</code>","text":"<p>               Bases: <code>TimestampMixin</code>, <code>Model</code></p> <p>People or group in channels receive messages.</p> Source code in <code>django_slack_tools/slack_messages/models/message_recipient.py</code> <pre><code>class SlackMessageRecipient(TimestampMixin, models.Model):\n    \"\"\"People or group in channels receive messages.\"\"\"\n\n    alias = models.CharField(\n        verbose_name=_(\"Alias\"),\n        help_text=_(\"Alias for this recipient.\"),\n        max_length=256,\n        unique=True,\n    )\n    channel = models.CharField(\n        verbose_name=_(\"Channel\"),\n        help_text=_(\"Slack channel ID where messages will be sent.\"),\n        max_length=128,\n        blank=False,\n    )\n    channel_name = models.CharField(\n        verbose_name=_(\"Channel name\"),\n        help_text=_(\"Display name of channel.\"),\n        max_length=256,\n        blank=True,\n        default=\"\",\n    )\n    mentions = models.ManyToManyField(\n        SlackMention,\n        verbose_name=_(\"Mentions\"),\n        help_text=_(\"List of mentions.\"),\n        blank=True,\n    )\n\n    objects: SlackMessageRecipientManager = SlackMessageRecipientManager()\n\n    class Meta:  # noqa: D106\n        verbose_name = _(\"Recipient\")\n        verbose_name_plural = _(\"Recipients\")\n\n    def __str__(self) -&gt; str:\n        num_mentions = self.mentions.count()\n\n        return _(\"{alias} ({channel}, {num_mentions} mentions)\").format(\n            alias=self.alias,\n            channel=self.channel,\n            num_mentions=num_mentions,\n        )\n</code></pre>"},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.models.SlackMessagingPolicy","title":"<code>SlackMessagingPolicy</code>","text":"<p>               Bases: <code>TimestampMixin</code>, <code>Model</code></p> <p>An Slack messaging policy which determines message content and those who receive messages.</p> Source code in <code>django_slack_tools/slack_messages/models/messaging_policy.py</code> <pre><code>class SlackMessagingPolicy(TimestampMixin, models.Model):\n    \"\"\"An Slack messaging policy which determines message content and those who receive messages.\"\"\"\n\n    class TemplateType(models.TextChoices):\n        \"\"\"Possible template types.\"\"\"\n\n        PYTHON = \"P\", _(\"Python\")\n        \"Dictionary-based template.\"\n\n        DJANGO = \"DJ\", _(\"Django\")\n        \"Django XML-based template.\"\n\n        DJANGO_INLINE = \"DI\", _(\"Django Inline\")\n        \"Django inline template.\"\n\n        UNKNOWN = \"?\", _(\"Unknown\")\n        \"Unknown template type.\"\n\n    code = models.CharField(\n        verbose_name=_(\"Code\"),\n        help_text=_(\"Unique message code for lookup, mostly by human.\"),\n        max_length=32,\n        unique=True,\n    )\n    enabled = models.BooleanField(\n        verbose_name=_(\"Enabled\"),\n        help_text=_(\"Turn on or off current messaging policy.\"),\n        default=True,\n    )\n    recipients = models.ManyToManyField(\n        SlackMessageRecipient,\n        verbose_name=_(\"Message recipients\"),\n        help_text=_(\"Those who will receive messages.\"),\n    )\n    header_defaults = models.JSONField(\n        verbose_name=_(\"Default header\"),\n        help_text=_(\"Default header values applied to messages on creation.\"),\n        validators=[header_validator],\n        blank=True,\n        default=dict,\n    )\n    template_type = models.CharField(\n        verbose_name=_(\"Template type\"),\n        help_text=_(\"Type of message template.\"),\n        max_length=2,\n        choices=TemplateType.choices,\n        default=TemplateType.PYTHON,\n    )\n    template: models.JSONField[Any] = models.JSONField(\n        verbose_name=_(\"Message template object\"),\n        help_text=_(\"Dictionary-based template object.\"),\n        null=True,\n        blank=True,\n    )\n\n    # Type is too obvious but due to limits...\n    objects: SlackMessagingPolicyManager = SlackMessagingPolicyManager()\n\n    class Meta:  # noqa: D106\n        verbose_name = _(\"Messaging Policy\")\n        verbose_name_plural = _(\"Messaging Policies\")\n\n    def __str__(self) -&gt; str:\n        num_recipients = self.recipients.all().count()\n        if self.enabled:\n            return _(\"{code} (enabled, {num_recipients} recipients)\").format(\n                code=self.code,\n                num_recipients=num_recipients,\n            )\n\n        return _(\"{code} (disabled, {num_recipients} recipients)\").format(code=self.code, num_recipients=num_recipients)\n</code></pre>"},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.models.SlackMessagingPolicy.TemplateType","title":"<code>TemplateType</code>","text":"<p>               Bases: <code>TextChoices</code></p> <p>Possible template types.</p> Source code in <code>django_slack_tools/slack_messages/models/messaging_policy.py</code> <pre><code>class TemplateType(models.TextChoices):\n    \"\"\"Possible template types.\"\"\"\n\n    PYTHON = \"P\", _(\"Python\")\n    \"Dictionary-based template.\"\n\n    DJANGO = \"DJ\", _(\"Django\")\n    \"Django XML-based template.\"\n\n    DJANGO_INLINE = \"DI\", _(\"Django Inline\")\n    \"Django inline template.\"\n\n    UNKNOWN = \"?\", _(\"Unknown\")\n    \"Unknown template type.\"\n</code></pre>"},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.models.SlackMessagingPolicy.TemplateType.DJANGO","title":"<code>DJANGO = ('DJ', _('Django'))</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>Django XML-based template.</p>"},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.models.SlackMessagingPolicy.TemplateType.DJANGO_INLINE","title":"<code>DJANGO_INLINE = ('DI', _('Django Inline'))</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>Django inline template.</p>"},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.models.SlackMessagingPolicy.TemplateType.PYTHON","title":"<code>PYTHON = ('P', _('Python'))</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>Dictionary-based template.</p>"},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.models.SlackMessagingPolicy.TemplateType.UNKNOWN","title":"<code>UNKNOWN = ('?', _('Unknown'))</code>  <code>class-attribute</code> <code>instance-attribute</code>","text":"<p>Unknown template type.</p>"},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.shortcuts","title":"<code>django_slack_tools.slack_messages.shortcuts</code>","text":"<p>Handy APIs for sending Slack messages.</p>"},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.shortcuts.slack_message","title":"<code>slack_message(to, *, messenger_name=None, header=None, template=None, context=None, message=None)</code>","text":"<pre><code>slack_message(\n    to: str,\n    *,\n    messenger_name: str | None = None,\n    header: MessageHeader | dict[str, Any] | None = None,\n    message: str,\n) -&gt; MessageResponse | None\n</code></pre><pre><code>slack_message(\n    to: str,\n    *,\n    messenger_name: str | None = None,\n    header: MessageHeader | dict[str, Any] | None = None,\n    template: str | None = None,\n    context: dict[str, Any] | None = None,\n) -&gt; MessageResponse | None\n</code></pre> <p>Shortcut for sending a Slack message.</p> <p>Parameters:</p> Name Type Description Default <code>to</code> <code>str</code> <p>Recipient.</p> required <code>messenger_name</code> <code>str | None</code> <p>Messenger name. If not set, default messenger is used.</p> <code>None</code> <code>header</code> <code>MessageHeader | dict[str, Any] | None</code> <p>Slack message control header.</p> <code>None</code> <code>template</code> <code>str | None</code> <p>Message template key. Cannot be used with <code>message</code>.</p> <code>None</code> <code>context</code> <code>dict[str, Any] | None</code> <p>Context for rendering the template. Only used with <code>template</code>.</p> <code>None</code> <code>message</code> <code>str | None</code> <p>Simple message text. Cannot be used with <code>template</code>.</p> <code>None</code> <p>Returns:</p> Type Description <code>MessageResponse | None</code> <p>Sent message instance or <code>None</code>.</p> Source code in <code>django_slack_tools/slack_messages/shortcuts.py</code> <pre><code>def slack_message(  # noqa: PLR0913\n    to: str,\n    *,\n    messenger_name: str | None = None,\n    header: MessageHeader | dict[str, Any] | None = None,\n    template: str | None = None,\n    context: dict[str, Any] | None = None,\n    message: str | None = None,\n) -&gt; MessageResponse | None:\n    \"\"\"Shortcut for sending a Slack message.\n\n    Args:\n        to: Recipient.\n        messenger_name: Messenger name. If not set, default messenger is used.\n        header: Slack message control header.\n        template: Message template key. Cannot be used with `message`.\n        context: Context for rendering the template. Only used with `template`.\n        message: Simple message text. Cannot be used with `template`.\n\n    Returns:\n        Sent message instance or `None`.\n    \"\"\"\n    if (template and message) or (not template and not message):\n        msg = \"Either `template` or `message` must be set, but not both.\"\n        raise ValueError(msg)\n\n    messenger = get_messenger(messenger_name)\n    header = MessageHeader.from_any(header)\n\n    if message:\n        request = MessageRequest(\n            channel=to,\n            header=header,\n            body=MessageBody(text=message),\n            template_key=None,\n            context={},\n        )\n        return messenger.send_request(request)\n\n    context = context or {}\n    return messenger.send(to, header=header, template=template, context=context)\n</code></pre>"},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.tasks","title":"<code>django_slack_tools.slack_messages.tasks</code>","text":"<p>Celery utils.</p>"},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.tasks.cleanup_old_messages","title":"<code>cleanup_old_messages(*, base_ts=None, threshold_seconds=7 * 24 * 60 * 60)</code>","text":"<p>Delete old messages created before given threshold.</p> <p>Parameters:</p> Name Type Description Default <code>threshold_seconds</code> <code>int | None</code> <p>Threshold seconds. Defaults to 7 days.</p> <code>7 * 24 * 60 * 60</code> <code>base_ts</code> <code>str | None</code> <p>Base timestamp to calculate the threshold, in ISO format. If falsy, current timestamp will be used.</p> <code>None</code> <p>Returns:</p> Type Description <code>int</code> <p>Number of deleted messages.</p> Source code in <code>django_slack_tools/slack_messages/tasks.py</code> <pre><code>@shared_task\ndef cleanup_old_messages(\n    *,\n    base_ts: str | None = None,\n    threshold_seconds: int | None = 7 * 24 * 60 * 60,  # 7 days\n) -&gt; int:\n    \"\"\"Delete old messages created before given threshold.\n\n    Args:\n        threshold_seconds: Threshold seconds. Defaults to 7 days.\n        base_ts: Base timestamp to calculate the threshold, in ISO format. If falsy, current timestamp will be used.\n\n    Returns:\n        Number of deleted messages.\n    \"\"\"\n    dt = datetime.fromisoformat(base_ts) if base_ts else timezone.localtime()\n\n    if threshold_seconds is None:\n        logger.warning(\"Threshold seconds not provided, skipping cleanup.\")\n        return 0\n\n    cleanup_threshold = dt - timedelta(seconds=threshold_seconds)\n    logger.debug(\"Cleaning up messages older than %s.\", cleanup_threshold)\n\n    num_deleted, _ = SlackMessage.objects.filter(created__lt=cleanup_threshold).delete()\n    logger.info(\"Deleted %d old messages.\", num_deleted)\n\n    return num_deleted\n</code></pre>"},{"location":"api-references/slack-messages/#django_slack_tools.slack_messages.tasks.slack_message","title":"<code>slack_message(*args, **kwargs)</code>","text":"<p>Celery task wrapper for <code>.shortcuts.slack_message</code>.</p> <p>Parameters:</p> Name Type Description Default <code>args</code> <code>Any</code> <p>Positional arguments.</p> <code>()</code> <code>kwargs</code> <code>Any</code> <p>Keyword arguments.</p> <code>{}</code> <p>Returns:</p> Type Description <code>str | None</code> <p>ID of sent message if any, <code>None</code> otherwise.</p> Source code in <code>django_slack_tools/slack_messages/tasks.py</code> <pre><code>@shared_task\ndef slack_message(*args: Any, **kwargs: Any) -&gt; str | None:\n    \"\"\"Celery task wrapper for `.shortcuts.slack_message`.\n\n    Args:\n        args: Positional arguments.\n        kwargs: Keyword arguments.\n\n    Returns:\n        ID of sent message if any, `None` otherwise.\n    \"\"\"\n    response = shortcuts.slack_message(*args, **kwargs)\n    return response.ts if response else None\n</code></pre>"},{"location":"usages/celery-support/","title":"Celery Support","text":"<p>Celery utils.</p>"},{"location":"usages/celery-support/#django_slack_tools.slack_messages.tasks.cleanup_old_messages","title":"<code>cleanup_old_messages(*, base_ts=None, threshold_seconds=7 * 24 * 60 * 60)</code>","text":"<p>Delete old messages created before given threshold.</p> <p>Parameters:</p> Name Type Description Default <code>threshold_seconds</code> <code>int | None</code> <p>Threshold seconds. Defaults to 7 days.</p> <code>7 * 24 * 60 * 60</code> <code>base_ts</code> <code>str | None</code> <p>Base timestamp to calculate the threshold, in ISO format. If falsy, current timestamp will be used.</p> <code>None</code> <p>Returns:</p> Type Description <code>int</code> <p>Number of deleted messages.</p> Source code in <code>django_slack_tools/slack_messages/tasks.py</code> <pre><code>@shared_task\ndef cleanup_old_messages(\n    *,\n    base_ts: str | None = None,\n    threshold_seconds: int | None = 7 * 24 * 60 * 60,  # 7 days\n) -&gt; int:\n    \"\"\"Delete old messages created before given threshold.\n\n    Args:\n        threshold_seconds: Threshold seconds. Defaults to 7 days.\n        base_ts: Base timestamp to calculate the threshold, in ISO format. If falsy, current timestamp will be used.\n\n    Returns:\n        Number of deleted messages.\n    \"\"\"\n    dt = datetime.fromisoformat(base_ts) if base_ts else timezone.localtime()\n\n    if threshold_seconds is None:\n        logger.warning(\"Threshold seconds not provided, skipping cleanup.\")\n        return 0\n\n    cleanup_threshold = dt - timedelta(seconds=threshold_seconds)\n    logger.debug(\"Cleaning up messages older than %s.\", cleanup_threshold)\n\n    num_deleted, _ = SlackMessage.objects.filter(created__lt=cleanup_threshold).delete()\n    logger.info(\"Deleted %d old messages.\", num_deleted)\n\n    return num_deleted\n</code></pre>"},{"location":"usages/celery-support/#django_slack_tools.slack_messages.tasks.slack_message","title":"<code>slack_message(*args, **kwargs)</code>","text":"<p>Celery task wrapper for <code>.shortcuts.slack_message</code>.</p> <p>Parameters:</p> Name Type Description Default <code>args</code> <code>Any</code> <p>Positional arguments.</p> <code>()</code> <code>kwargs</code> <code>Any</code> <p>Keyword arguments.</p> <code>{}</code> <p>Returns:</p> Type Description <code>str | None</code> <p>ID of sent message if any, <code>None</code> otherwise.</p> Source code in <code>django_slack_tools/slack_messages/tasks.py</code> <pre><code>@shared_task\ndef slack_message(*args: Any, **kwargs: Any) -&gt; str | None:\n    \"\"\"Celery task wrapper for `.shortcuts.slack_message`.\n\n    Args:\n        args: Positional arguments.\n        kwargs: Keyword arguments.\n\n    Returns:\n        ID of sent message if any, `None` otherwise.\n    \"\"\"\n    response = shortcuts.slack_message(*args, **kwargs)\n    return response.ts if response else None\n</code></pre>"},{"location":"usages/sending-messages/","title":"Sending Messages","text":"<p>Handy APIs for sending Slack messages.</p>"},{"location":"usages/sending-messages/#django_slack_tools.slack_messages.shortcuts.slack_message","title":"<code>slack_message(to, *, messenger_name=None, header=None, template=None, context=None, message=None)</code>","text":"<pre><code>slack_message(\n    to: str,\n    *,\n    messenger_name: str | None = None,\n    header: MessageHeader | dict[str, Any] | None = None,\n    message: str,\n) -&gt; MessageResponse | None\n</code></pre><pre><code>slack_message(\n    to: str,\n    *,\n    messenger_name: str | None = None,\n    header: MessageHeader | dict[str, Any] | None = None,\n    template: str | None = None,\n    context: dict[str, Any] | None = None,\n) -&gt; MessageResponse | None\n</code></pre> <p>Shortcut for sending a Slack message.</p> <p>Parameters:</p> Name Type Description Default <code>to</code> <code>str</code> <p>Recipient.</p> required <code>messenger_name</code> <code>str | None</code> <p>Messenger name. If not set, default messenger is used.</p> <code>None</code> <code>header</code> <code>MessageHeader | dict[str, Any] | None</code> <p>Slack message control header.</p> <code>None</code> <code>template</code> <code>str | None</code> <p>Message template key. Cannot be used with <code>message</code>.</p> <code>None</code> <code>context</code> <code>dict[str, Any] | None</code> <p>Context for rendering the template. Only used with <code>template</code>.</p> <code>None</code> <code>message</code> <code>str | None</code> <p>Simple message text. Cannot be used with <code>template</code>.</p> <code>None</code> <p>Returns:</p> Type Description <code>MessageResponse | None</code> <p>Sent message instance or <code>None</code>.</p> Source code in <code>django_slack_tools/slack_messages/shortcuts.py</code> <pre><code>def slack_message(  # noqa: PLR0913\n    to: str,\n    *,\n    messenger_name: str | None = None,\n    header: MessageHeader | dict[str, Any] | None = None,\n    template: str | None = None,\n    context: dict[str, Any] | None = None,\n    message: str | None = None,\n) -&gt; MessageResponse | None:\n    \"\"\"Shortcut for sending a Slack message.\n\n    Args:\n        to: Recipient.\n        messenger_name: Messenger name. If not set, default messenger is used.\n        header: Slack message control header.\n        template: Message template key. Cannot be used with `message`.\n        context: Context for rendering the template. Only used with `template`.\n        message: Simple message text. Cannot be used with `template`.\n\n    Returns:\n        Sent message instance or `None`.\n    \"\"\"\n    if (template and message) or (not template and not message):\n        msg = \"Either `template` or `message` must be set, but not both.\"\n        raise ValueError(msg)\n\n    messenger = get_messenger(messenger_name)\n    header = MessageHeader.from_any(header)\n\n    if message:\n        request = MessageRequest(\n            channel=to,\n            header=header,\n            body=MessageBody(text=message),\n            template_key=None,\n            context={},\n        )\n        return messenger.send_request(request)\n\n    context = context or {}\n    return messenger.send(to, header=header, template=template, context=context)\n</code></pre>"}]}